<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



















  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.5.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.5.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.5.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.5.0',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="前端生涯记录总结">
<meta name="keywords" content="html,css,javascript,webpack,vue,react,nodejs">
<meta property="og:type" content="website">
<meta property="og:title" content="老李">
<meta property="og:url" content="https://cleam.github.io/index.html">
<meta property="og:site_name" content="老李">
<meta property="og:description" content="前端生涯记录总结">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="老李">
<meta name="twitter:description" content="前端生涯记录总结">



  <link rel="alternate" href="/atom.xml" title="老李" type="application/atom+xml">




  <link rel="canonical" href="https://cleam.github.io/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>老李</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">老李</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">~路漫漫其修远兮~</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cleam.github.io/2021/10/14/Web指标学习（about-Sentry）/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cleam Lee">
      <meta itemprop="description" content="前端生涯记录总结">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老李">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/10/14/Web指标学习（about-Sentry）/" class="post-title-link" itemprop="https://cleam.github.io/index.html">Web 指标学习（about Sentry）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-10-14 10:47:08 / 修改时间：10:55:44" itemprop="dateCreated datePublished" datetime="2021-10-14T10:47:08+08:00">2021-10-14</time>
            

            
              

              
            
          </span>

          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2021/10/14/Web指标学习（about-Sentry）/#SOHUCS" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span id="url::https://cleam.github.io/2021/10/14/Web指标学习（about-Sentry）/" class="cy_cmt_count" data-xid="2021/10/14/Web指标学习（about-Sentry）/" itemprop="commentsCount"></span>
                </a>
              
            
          

          
          

          

          

          

        </span></div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://web.dev/vitals/" target="_blank" rel="noopener">Web 指标</a>是一组由 Google 定义的指标，用于衡量呈现时间、响应时间和布局偏移。每个数据点都提供有关应用程序整体性能的见解。</p>
<p>Sentry SDK 收集 Web 指标信息（如果浏览器支持的话）并将该信息添加到前端事务中。然后将这些重要信息汇总在几个图表中，以便快速了解每个前端事务对用户的执行情况。</p>
<p><img src="/uploads/post/web-vitals-1.png" alt="Web Vitals 的可视化"></p>
<h2 id="核心-Web-指标"><a href="#核心-Web-指标" class="headerlink" title="核心 Web 指标"></a>核心 Web 指标</h2><p>这些 Web 指标被谷歌认为是直接衡量用户体验的最重要的指标。<a href="https://developers.google.com/search/blog/2020/11/timing-for-page-experience" target="_blank" rel="noopener">Google 报告称，截至 2021 年 5 月，这些指标也会影响网站的搜索排名</a>。</p>
<h3 id="最大的内容绘制-LCP"><a href="#最大的内容绘制-LCP" class="headerlink" title="最大的内容绘制 (LCP)"></a>最大的内容绘制 (LCP)</h3><p><a href="https://web.dev/lcp/" target="_blank" rel="noopener">最大内容绘制 (LCP)</a>测量最大内容出现在视口中的渲染时间。这可以是来自文档对象模型 (DOM) 的任何形式，例如图像（images）、SVG 或文本块（text blocks）。视口中最大的像素区域，因此最直观。<strong>LCP 帮助开发人员了解用户看到页面上的主要内容需要多长时间。</strong></p>
<h3 id="首次输入延迟-FID"><a href="#首次输入延迟-FID" class="headerlink" title="首次输入延迟 (FID)"></a>首次输入延迟 (FID)</h3><p><a href="https://web.dev/fid/" target="_blank" rel="noopener">首次输入延迟 (FID)</a>测量用户尝试与视口交互时的响应时间。操作可能包括单击按钮（button）、链接（link）或其他自定义 Javascript 控制器。<strong>FID 提供有关应用程序页面上成功或不成功交互的关键数据。</strong></p>
<h3 id="累积布局偏移-CLS"><a href="#累积布局偏移-CLS" class="headerlink" title="累积布局偏移 (CLS)"></a>累积布局偏移 (CLS)</h3><p><a href="https://web.dev/cls/" target="_blank" rel="noopener">累积布局偏移 (CLS)</a>是渲染过程中每个意外元素偏移的单个布局偏移分数的总和。想象一下导航到一篇文章并尝试在页面完成加载之前单击链接。在您的光标到达那里之前，链接可能由于图像渲染而向下移动。<strong>CLS 分数代表了破坏性和视觉不稳定转变的程度，而不是使用持续时间来表示此 Web 指标。</strong></p>
<p><img src="/uploads/post/web-vitals-2.png" alt="累积布局偏移示例"></p>
<p>使用影响和距离分数计算每个布局偏移分数。影响分数是元素在两个渲染帧之间影响的总可见区域。距离分数测量它相对于视口移动的距离。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Layout Shift Score = Impact Fraction * Distance Fraction</span></span><br><span class="line">布局偏移分数 = 影响分数 * 距离分数</span><br></pre></td></tr></table></figure>
<p>让我们看一下上面的例子，它有一个不稳定的元素——正文内容。影响分数大约为页面的 <code>50%</code>，并将正文文本向下移动 <code>20%</code>。布局移位得分为 <code>0.5 * 0.2 = 0.1</code>。因此，CLS 为 0.1。</p>
<h2 id="其他-Web-指标"><a href="#其他-Web-指标" class="headerlink" title="其他 Web 指标"></a>其他 Web 指标</h2><p>这些 Web 指标通常不太容易被用户看到，但对于排除核心 Web 指标的问题很有用。</p>
<h3 id="首次渲染（FP）"><a href="#首次渲染（FP）" class="headerlink" title="首次渲染（FP）"></a>首次渲染（FP）</h3><p>首次渲染 (FP) 测量第一个像素出现在视口中所需的时间，呈现与先前显示内容相比的任何视觉变化。这可以是来自文档对象模型 (DOM) 的任何形式，例如背景颜色（background-color）、画布（canvas）或图像（image）。<strong>FP 可帮助开发人员了解渲染页面是否发生了任何意外。</strong></p>
<h3 id="首次内容绘制-FCP"><a href="#首次内容绘制-FCP" class="headerlink" title="首次内容绘制 (FCP)"></a>首次内容绘制 (FCP)</h3><p><a href="https://web.dev/fcp/" target="_blank" rel="noopener">首次内容绘制 (FCP)</a>测量第一个内容在视口中呈现的时间。这可以是来自文档对象模型 (DOM) 的任何形式，例如图像、SVG 或文本块。<strong>FCP 经常与首次渲染（FP）重叠。FCP 帮助开发人员了解用户在页面上看到内容更新需要多长时间。</strong></p>
<h3 id="首字节时间-TTFB"><a href="#首字节时间-TTFB" class="headerlink" title="首字节时间 (TTFB)"></a>首字节时间 (TTFB)</h3><p>首字节时间（TTFB）测量用户浏览器接收页面内容的第一个字节所需的时间。<strong>TTFB 帮助开发人员了解他们的缓慢是由初始响应引起的还是由于渲染阻塞内容引起的。</strong></p>
<h2 id="阈值"><a href="#阈值" class="headerlink" title="阈值"></a>阈值</h2><p>谷歌定义的三个阈值：“<code>好（GOOD）</code>”、“<code>需要改进（NEEDS IMPROVEMENT）</code>”和“<code>差（POOR）</code>”用于将数据点分类为绿色、黄色和红色，用于对应的 Web 指标。“需要改进（NEEDS IMPROVEMENT）”在 Sentry 中被称为“<code>Meh</code>”。</p>
<table>
<thead>
<tr>
<th>Web 指标</th>
<th>好</th>
<th>需要改进</th>
<th>差</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://docs.sentry.io/product/performance/web-vitals/#largest-contentful-paint-lcp" target="_blank" rel="noopener">最大的内容绘制</a>(LCP)</td>
<td>&lt;= 2.5s</td>
<td>&lt;= 4s</td>
<td>&gt; 4s</td>
</tr>
<tr>
<td><a href="https://docs.sentry.io/product/performance/web-vitals/#first-input-delay-fid" target="_blank" rel="noopener">首次输入延迟</a>(FID)</td>
<td>&lt;= 100ms</td>
<td>&lt;= 300ms</td>
<td>&gt; 300ms</td>
</tr>
<tr>
<td><a href="https://docs.sentry.io/product/performance/web-vitals/#cumulative-layout-shift-cls" target="_blank" rel="noopener">累积布局偏移</a>(CLS)</td>
<td>&lt;= 0.1</td>
<td>&lt;= 0.25</td>
<td>&gt; 0.25</td>
</tr>
<tr>
<td><a href="https://docs.sentry.io/product/performance/web-vitals/#first-paint-fp" target="_blank" rel="noopener">首次渲染</a>(FP)</td>
<td>&lt;= 1s</td>
<td>&lt;= 3s</td>
<td>&gt; 3s</td>
</tr>
<tr>
<td><a href="https://docs.sentry.io/product/performance/web-vitals/#first-contentful-paint-fcp" target="_blank" rel="noopener">首次内容绘制</a>(FCP)</td>
<td>&lt;= 1s</td>
<td>&lt;= 3s</td>
<td>&gt; 3s</td>
</tr>
<tr>
<td><a href="https://docs.sentry.io/product/performance/web-vitals/#time-to-first-byte-ttfb" target="_blank" rel="noopener">首字节时间</a>(TTFB)</td>
<td>&lt;= 100ms</td>
<td>&lt;= 200ms</td>
<td>&gt; 600ms</td>
</tr>
</tbody>
</table>
<blockquote>
<p>一些 Web 指标（例如 FP、FCP、LCP 和 TTFB）是相对于事务的开始进行测量的。与使用其他工具（例如 Lighthouse ）生成的值相比，值可能会有所不同。</p>
</blockquote>
<h2 id="分布直方图"><a href="#分布直方图" class="headerlink" title="分布直方图"></a>分布直方图</h2><p><img src="/uploads/post/web-vitals-3.png" alt="分布直方图"></p>
<p>Web 指标直方图显示数据分布，它可以通过揭示异常来帮助您识别和诊断前端性能问题。</p>
<p>默认情况下，异常值将从直方图中排除，以提供有关这些生命体征的更多信息视图。异常值是使用<a href="https://en.wikipedia.org/wiki/Outlier#Tukey&#39;s_fences" target="_blank" rel="noopener">上外栅栏（upper outer fence）</a>作为上限来确定的，任何高于上限的数据点都被视为异常值。</p>
<p>每个 Web 指标的垂直标记是观察到的数据点的第 75 个百分位。换句话说，25% 的记录值超过了该数量。</p>
<p>如果您注意到任何直方图上的感兴趣区域，请单击并拖动放大该区域以获得更详细的视图。您可能还想在直方图中查看与事务相关的更多信息。单击所选 Web 指标下方的“在发现中打开（Open in Discover）”以构建自定义查询以进行进一步调查。有关更多详细信息，请参阅 <a href="https://docs.sentry.io/product/discover-queries/query-builder/" target="_blank" rel="noopener">Discover Query Builder</a> 的完整文档。</p>
<p>如果您希望查看所有可用数据，请打开下拉菜单并单击“查看全部（View All）”。单击“查看全部”时，您可能会看到极端异常值。您可以单击并拖动放大某个区域以获得更详细的视图。</p>
<h2 id="浏览器支持"><a href="#浏览器支持" class="headerlink" title="浏览器支持"></a>浏览器支持</h2><table>
<thead>
<tr>
<th>Web 指标</th>
<th>Chrome</th>
<th>Edge</th>
<th>Opera</th>
<th>Firefox</th>
<th>Safari</th>
<th>IE</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://docs.sentry.io/product/performance/web-vitals/#largest-contentful-paint-lcp" target="_blank" rel="noopener">最大的内容绘制</a>(LCP)</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="https://docs.sentry.io/product/performance/web-vitals/#first-input-delay-fid" target="_blank" rel="noopener">首次输入延迟</a>(FID)</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr>
<td><a href="https://docs.sentry.io/product/performance/web-vitals/#cumulative-layout-shift-cls" target="_blank" rel="noopener">累积布局偏移</a>(CLS)</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="https://docs.sentry.io/product/performance/web-vitals/#first-paint-fp" target="_blank" rel="noopener">首次渲染</a>(FP)</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="https://docs.sentry.io/product/performance/web-vitals/#first-contentful-paint-fcp" target="_blank" rel="noopener">首次内容绘制</a>(FCP)</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td></td>
</tr>
<tr>
<td><a href="https://docs.sentry.io/product/performance/web-vitals/#time-to-first-byte-ttfb" target="_blank" rel="noopener">首字节时间</a>(TTFB)</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
</tbody>
</table>
<blockquote>
<p>原文：<a href="https://docs.sentry.io/product/performance/web-vitals/" target="_blank" rel="noopener">Web Vitals</a></p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cleam.github.io/2021/10/09/sonar质量规则学习之JavaScript/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cleam Lee">
      <meta itemprop="description" content="前端生涯记录总结">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老李">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/10/09/sonar质量规则学习之JavaScript/" class="post-title-link" itemprop="https://cleam.github.io/index.html">sonar质量规则学习之JavaScript</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-10-09 18:11:10 / 修改时间：18:41:45" itemprop="dateCreated datePublished" datetime="2021-10-09T18:11:10+08:00">2021-10-09</time>
            

            
              

              
            
          </span>

          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2021/10/09/sonar质量规则学习之JavaScript/#SOHUCS" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span id="url::https://cleam.github.io/2021/10/09/sonar质量规则学习之JavaScript/" class="cy_cmt_count" data-xid="2021/10/09/sonar质量规则学习之JavaScript/" itemprop="commentsCount"></span>
                </a>
              
            
          

          
          

          

          

          

        </span></div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>该文档列出了比较容易违反、比较重要的几个规则，更多规则请查看：<a href="https://rules.sonarsource.com/javascript" target="_blank" rel="noopener">sonar rules for js</a></p>
<h2>代码段不应被注释掉（<a href="https://rules.sonarsource.com/javascript/RSPEC-125" target="_blank" rel="noopener">Sections of code should not be commented out</a>）</h2>
<p>程序员不应注释掉代码，因为它会使程序膨胀并降低可读性。未使用的代码应该被删除，如果需要，可以从源代码控制历史（如：Git History）中检索。</p>
<p>有些情况可能会误报、不合理报错或者本来就是有用的注释，可以试试使用<code>//NOSONAR</code>来规避：</p>
<p><img src="/uploads/post/js.png" alt="js with sonar warn"></p>
<p>加上<code>//NOSONAR</code>，sonar扫描便会忽略掉，就不会再有警告：</p>
<p><img src="/uploads/post/js-nosonar.png" alt="js with NOSONAR"></p>
<h2>功能函数认知复杂度（圈复杂度）不应太高（<a href="https://rules.sonarsource.com/javascript/RSPEC-3776" target="_blank" rel="noopener">Cognitive Complexity of functions should not be too high</a>）</h2>
<p>认知复杂性是衡量函数控制流理解难度的指标。认知复杂度高的功能将难以维护。详情请看《<a href="/2021/09/23/cognitive-complexity/" title="认知复杂度（cognitive complexity ）">认知复杂度（cognitive complexity ）</a>》</p>
<h2>变量不应该被隐藏（<a href="https://rules.sonarsource.com/javascript/RSPEC-1117" target="_blank" rel="noopener">Variables should not be shadowed</a>）</h2>
<p>重写或隐藏在外部作用域中声明的变量会严重影响代码的可读性，从而影响代码的可维护性。此外，这可能会导致维护人员引入 bug，因为他们认为自己在使用某一个变量，但实际上在使用另一个变量。</p>
<h2>三元运算符不应该嵌套（<a href="https://rules.sonarsource.com/javascript/RSPEC-3358" target="_blank" rel="noopener">Ternary operators should not be nested</a>）</h2>
<p>三元运算符嵌套虽然可以解决问题，刚开始编写的时候看起来可能很清晰，但是随着时间延长会增加后期的维护难度。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getReadableStatus</span>(<span class="params">job</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> job.isRunning() ? <span class="string">'Running'</span> : job.hasErrors() ? <span class="string">'Failed'</span> : <span class="string">'Succeeded '</span>; <span class="comment">// Noncompliant</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getReadableStatus</span>(<span class="params">job</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (job.isRunning()) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Running'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> job.hasErrors() ? <span class="string">'Failed'</span> : <span class="string">'Succeeded'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>应删除未使用的分配（变量）（<a href="https://rules.sonarsource.com/javascript/RSPEC-1854" target="_blank" rel="noopener">Unused assignments should be removed</a>）</h2>
<p>定义了一个变量并对其进行了赋值操作，但实际上却未使用。可能是错误操作导致（比如代码删错），也可能是失误多写了。但总归是无用的，可以删除掉。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">i = a + b; <span class="comment">// Noncompliant; calculation result not used before value is overwritten</span></span><br><span class="line">i = compute();</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">i = a + b;</span><br><span class="line">i += compute();</span><br></pre></td></tr></table></figure></p>
<p>例外情况:</p>
<ul>
<li>初始化值为<code>-1, 0, 1, null, undefined, [], {}, true, false, &quot;&quot;</code>的会被该规则忽略</li>
<li>此规则还忽略使用 rest 语法（用于从对象中排除某些属性）进行对象分解时声明的变量</li>
</ul>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; a, b, ...rest &#125; = obj; <span class="comment">// 'a' and 'b' are ok</span></span><br><span class="line">doSomething(rest);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [x1, x2, x3] = arr; <span class="comment">// but 'x1' is noncompliant, as omitting syntax can be used: "let [, x2, x3] = arr;"</span></span><br><span class="line">doSomething(x2, x3);</span><br></pre></td></tr></table></figure></p>
<h2>“for of”应该与可迭代对象一起使用（<a href="https://rules.sonarsource.com/javascript/RSPEC-4138" target="_blank" rel="noopener">&quot;for of&quot; should be used with Iterables</a>）</h2>
<p>如果您有一个可迭代对象，例如数组、集合或列表，则循环遍历其值的最佳选择是 for of 语法。 这可以使代码看起来更干净、清晰。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">  <span class="comment">// Noncompliant</span></span><br><span class="line">  <span class="built_in">console</span>.log(arr[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> arr) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>应删除未使用的局部变量或函数（<a href="https://rules.sonarsource.com/javascript/RSPEC-1481" target="_blank" rel="noopener">Unused local variables and functions should be removed</a>）</h2>
<p>如果声明了局部变量或局部函数但未使用，则它是死代码，应删除。 这样做将提高可维护性，因为开发人员不会想知道变量或函数的用途。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">numberOfMinutes</span>(<span class="params">hours</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> seconds = <span class="number">0</span>; <span class="comment">// seconds is never used</span></span><br><span class="line">  <span class="keyword">return</span> hours * <span class="number">60</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">numberOfMinutes</span>(<span class="params">hours</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> hours * <span class="number">60</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>函数不应有相同的实现（<a href="https://rules.sonarsource.com/javascript/RSPEC-4144" target="_blank" rel="noopener">Functions should not have identical implementations</a>）</h2>
<p>当两个函数具有相同的实现时，要么是一个错误（有其他用途），要么重复是故意的，但可能会使维护者感到困惑。 在后一种情况下，应该重构代码。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculateCode</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  doTheThing();</span><br><span class="line">  doOtherThing();</span><br><span class="line">  <span class="keyword">return</span> code;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Noncompliant</span></span><br><span class="line">  doTheThing();</span><br><span class="line">  doOtherThing();</span><br><span class="line">  <span class="keyword">return</span> code;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculateCode</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  doTheThing();</span><br><span class="line">  doOtherThing();</span><br><span class="line">  <span class="keyword">return</span> code;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> calculateCode();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>不应有空函数（<a href="https://rules.sonarsource.com/javascript/RSPEC-1186" target="_blank" rel="noopener">Functions should not be empty</a>）</h2>
<p>函数没有函数体有几个原因：</p>
<ul>
<li>这是一个无意的遗漏，应该修复以防止生产中出现意外行为。</li>
<li>它尚未或永远不会得到支持。 在这种情况下，应该在该机制可用的语言中抛出异常。</li>
<li>该方法是一个有意的空白覆盖。 在这种情况下，嵌套注释应解释空白覆盖的原因。</li>
</ul>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;;</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// This is intentional</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  do_something();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2>分配（的变量）不应是多余的（<a href="https://rules.sonarsource.com/javascript/RSPEC-4165" target="_blank" rel="noopener">Assignments should not be redundant</a>）</h2>
<p>有些变量分配是没必要的，所以可以优化掉。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = b;</span><br><span class="line">c = a;</span><br><span class="line">b = c; <span class="comment">// Noncompliant: c and b are already the same</span></span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = b;</span><br><span class="line">c = a;</span><br></pre></td></tr></table></figure></p>
<h2>不应在子表达式中进行赋值（<a href="https://rules.sonarsource.com/javascript/RSPEC-1121" target="_blank" rel="noopener">Assignments should not be made from within sub-expressions</a>）</h2>
<p>子表达式中的赋值很难被发现，因此降低了代码的可读性。 理想情况下，子表达式不应该有副作用。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((val = value() &amp;&amp; check())) &#123;</span><br><span class="line">  <span class="comment">// Noncompliant</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val = value();</span><br><span class="line"><span class="keyword">if</span> (val &amp;&amp; check()) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>不应声明局部变量然后立即返回或抛出（<a href="https://rules.sonarsource.com/javascript/RSPEC-1488" target="_blank" rel="noopener">Local variables should not be declared and then immediately returned or thrown</a>）</h2>
<p>声明一个变量只是为了立即返回或抛出它是一种不好的做法。</p>
<p>一些开发人员认为这种做法提高了代码的可读性，因为它使他们能够明确地命名返回的内容。 然而，这个变量是一个内部实现细节，不会暴露给方法的调用者。 方法名称应该足以让调用者确切地知道将返回什么。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">computeDurationInMilliseconds</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> duration = ((hours * <span class="number">60</span> + minutes) * <span class="number">60</span> + seconds) * <span class="number">1000</span>;</span><br><span class="line">  <span class="keyword">return</span> duration;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">computeDurationInMilliseconds</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ((hours * <span class="number">60</span> + minutes) * <span class="number">60</span> + seconds) * <span class="number">1000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>条件结构中的两个分支不应具有完全相同的实现（<a href="https://rules.sonarsource.com/javascript/RSPEC-1871" target="_blank" rel="noopener">Two branches in a conditional structure should not have exactly the same implementation</a>）</h2>
<blockquote>
<p>类似规则：条件结构中的所有分支不应具有完全相同的实现(<a href="https://rules.sonarsource.com/javascript/RSPEC-3923" target="_blank" rel="noopener">All branches in a conditional structure should not have exactly the same implementation</a>)</p>
</blockquote>
<p>switch 语句中的两个 case 或 if 链中的两个分支具有相同的实现充其量是重复代码，最坏的情况是编码错误。 如果两个实例确实需要相同的逻辑，那么在 if 链中它们应该被组合，或者对于一个 switch，一个应该落到另一个。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (i) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    doFirstThing();</span><br><span class="line">    doSomething();</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    doSomethingDifferent();</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">3</span>: <span class="comment">// 不合规; 与case 1的实现重复</span></span><br><span class="line">    doFirstThing();</span><br><span class="line">    doSomething();</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    doTheRest();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (a &gt;= <span class="number">0</span> &amp;&amp; a &lt; <span class="number">10</span>) &#123;</span><br><span class="line">  doFirstThing();</span><br><span class="line">  doTheThing();</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (a &gt;= <span class="number">10</span> &amp;&amp; a &lt; <span class="number">20</span>) &#123;</span><br><span class="line">  doTheOtherThing();</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (a &gt;= <span class="number">20</span> &amp;&amp; a &lt; <span class="number">50</span>) &#123;</span><br><span class="line">  doFirstThing();</span><br><span class="line">  doTheThing(); <span class="comment">// 不合规; 与第一个条件的实现重复</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  doTheRest();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>例外情况：</p>
<p>if 链中包含单行代码的块将被忽略，就像 switch 语句中包含单行代码（带有或不带有后续中断）的块一样。</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a == <span class="number">1</span>) &#123;</span><br><span class="line">  doSomething(); <span class="comment">// 没问题，通常这样做是为了提高可读性</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (a == <span class="number">2</span>) &#123;</span><br><span class="line">  doSomethingElse();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  doSomething();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>但是这个例外不适用于<strong>没有 else 的 if 链</strong>，或者当所有分支都具有相同的单行代码时<strong>没有 default 子句的 switch</strong>。 如果 if 链带有 else 或带有 default 子句的 switch，规则 {rule:javascript:S3923} 会引发错误。</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a == <span class="number">1</span>) &#123;</span><br><span class="line">  doSomething(); <span class="comment">// 不合规，这可能是故意的（也可能不是）</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (a == <span class="number">2</span>) &#123;</span><br><span class="line">  doSomething();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>不应该在比较中使用布尔字面量（<a href="https://rules.sonarsource.com/javascript/RSPEC-1125" target="_blank" rel="noopener">Boolean literals should not be used in comparisons</a>）</h2>
<p>在比较表达式 == 和 != 中应避免使用布尔字面量，以提高代码可读性。此规则还报告冗余的布尔运算。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> someValue = <span class="string">'0'</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (someValue == <span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (someBooleanValue != <span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br><span class="line">doSomething(!<span class="literal">false</span>);</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (someValue &amp;&amp; someValue != <span class="string">'0'</span>) &#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!someBooleanValue) &#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br><span class="line">doSomething(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure></p>
<h2>跳转语句不应冗余（<a href="https://rules.sonarsource.com/javascript/RSPEC-3626" target="_blank" rel="noopener">Jump statements should not be redundant</a>）</h2>
<p>跳转语句，例如 return、break 和 continue 可以让你改变程序执行的默认流程，但是将控制流引导到原始方向是多余的。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">redundantJump</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (x == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'x == 1'</span>);</span><br><span class="line">    <span class="keyword">return</span>; <span class="comment">// Noncompliant</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">redundantJump</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (x == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'x == 1'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>例外情况：</p>
<ul>
<li>switch 语句中的 break 和 return 被忽略，因为它们经常用于保持一致性。</li>
<li>continue with label 也被忽略，因为标签通常用于清晰起见。</li>
<li>此外，块中作为单个语句的跳转语句也将被忽略。</li>
</ul>
<h2>不应使用已弃用的 API（<a href="https://rules.sonarsource.com/javascript/RSPEC-1874" target="_blank" rel="noopener">Deprecated APIs should not be used</a>）</h2>
<h2>默认导出名称和文件名应匹配（<a href="https://rules.sonarsource.com/javascript/RSPEC-3317" target="_blank" rel="noopener">Default export names and file names should match</a>）</h2>
<p>按照惯例，只导出一个类、函数或常量的文件应该以该类、函数或常量命名。 否则可能使维护者感到困惑。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file path: myclass.js  -- Noncompliant</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyClass;</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file path: MyClass.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyClass;</span><br></pre></td></tr></table></figure></p>
<h2>函数应该总是返回同样的类型（<a href="https://rules.sonarsource.com/javascript/RSPEC-3800" target="_blank" rel="noopener">Functions should always return the same type</a>）</h2>
<p>与强类型语言不同，JavaScript 不强制函数的返回类型。 这意味着通过函数的不同路径可以返回不同类型的值，这可能会让使用者感到非常困惑并且难以维护。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Noncompliant</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (a === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (a === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>例外：返回 this 的函数将被忽略。</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>返回类型为 any 的表达式的函数将被忽略。</p>
<h2>没用到的引入应该删除掉（<a href="https://rules.sonarsource.com/javascript/RSPEC-1128" target="_blank" rel="noopener">Unnecessary imports should be removed</a>）</h2>
<p>没有理由导入你不使用的模块，这样做不必要地增加了负载。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Noncompliant, A isn't used</span></span><br><span class="line"><span class="keyword">import</span> A <span class="keyword">from</span> <span class="string">'a'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; B1 &#125; <span class="keyword">from</span> <span class="string">'b'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(B1);</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; B1 &#125; <span class="keyword">from</span> <span class="string">'b'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(B1);</span><br></pre></td></tr></table></figure></p>
<h2>不应使用“void”（<a href="https://rules.sonarsource.com/javascript/RSPEC-3735" target="_blank" rel="noopener">&quot;void&quot; should not be used</a>）</h2>
<p>void 运算符评估其参数并无条件地返回 undefined。 它在 ECMAScript 5 之前的环境中很有用， undefined 可以重新分配。但通常，它的使用会使代码更难理解。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> doSomething();</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">doSomething();</span><br></pre></td></tr></table></figure></p>
<p>例外：当使用 <code>void 0</code> 代替 undefined 时不会出现问题。</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (parameter === <span class="keyword">void</span> <span class="number">0</span>) &#123;...&#125;</span><br></pre></td></tr></table></figure></p>
<p>在立即调用的函数表达式之前使用 void 时，也不会出现问题。</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   ...</span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure></p>
<h2>带有默认值的函数参数应该放到最后（<a href="https://rules.sonarsource.com/javascript/RSPEC-1788" target="_blank" rel="noopener">Function parameters with default values should be last</a>）</h2>
<p>为函数参数定义默认值可以使函数更易于使用。默认参数值允许调用者根据需要指定尽可能多或尽可能少的参数，同时获得相同的功能并最大限度地减少样板(boilerplate)、包装器(wrapper)类似的代码。</p>
<p>但是所有带默认值的函数参数都应该在没有默认值的函数参数之后声明。否则，调用者就无法利用默认值；他们必须重新指定默认值或传递 <code>undefined</code> 以“获取”非默认参数。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Noncompliant</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params">a = <span class="number">1</span>, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x = multiply(<span class="number">42</span>); <span class="comment">// returns NaN as b is undefined</span></span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params">b, a = <span class="number">1</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x = multiply(<span class="number">42</span>); <span class="comment">// returns 42 as expected</span></span><br></pre></td></tr></table></figure></p>
<h2>不应访问或迭代空集合（<a href="https://rules.sonarsource.com/javascript/RSPEC-4158" target="_blank" rel="noopener">Empty collections should not be accessed or iterated</a>）</h2>
<p>当集合为空时，访问或迭代它是没有意义的。 无论如何这样做肯定是错误的。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> strings = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (strings.includes(<span class="string">"foo"</span>)) &#123; ... &#125;  <span class="comment">// Noncompliant</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (str <span class="keyword">of</span> strings) &#123; ... &#125;  <span class="comment">// Noncompliant</span></span><br><span class="line"></span><br><span class="line">strings.forEach(<span class="function"><span class="params">str</span> =&gt;</span> doSomething(str)); <span class="comment">// Noncompliant</span></span><br></pre></td></tr></table></figure></p>
<h2>内置函数的参数应该类型匹配（<a href="https://rules.sonarsource.com/javascript/RSPEC-3782" target="_blank" rel="noopener">Arguments to built-in functions should match documented types</a>）</h2>
<p>JavaScript 语言规范中指定了内置函数的参数类型。 对这些函数的调用应符合规定的类型，否则结果很可能不是预期的，例如：</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isTooSmall = <span class="built_in">Math</span>.abs(x &lt; <span class="number">0.0042</span>);</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isTooSmall = <span class="built_in">Math</span>.abs(x) &lt; <span class="number">0.0042</span>;</span><br></pre></td></tr></table></figure></p>
<h2>内置函数的参数应该类型匹配（<a href="https://rules.sonarsource.com/javascript/RSPEC-1940" target="_blank" rel="noopener">Boolean checks should not be inverted</a>）</h2>
<p>反转布尔比较增加了不必要的代码复杂度。应该进行相反的比较。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!(a === <span class="number">2</span>)) &#123; ... &#125;  <span class="comment">// Noncompliant</span></span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a !== <span class="number">2</span>) &#123; ... &#125;</span><br></pre></td></tr></table></figure></p>
<h2>不应忽略没有副作用的函数的返回值（<a href="https://rules.sonarsource.com/javascript/RSPEC-2201" target="_blank" rel="noopener">Return values from functions without side effects should not be ignored</a>）</h2>
<p>当对函数的调用没有任何副作用时，如果结果被忽略，调用的意义何在？ 在这种情况下，要么函数调用没用，应该删除，要么源代码没有按预期运行。</p>
<p>为防止产生任何误报，此规则仅在已知对象和功能的预定义列表上触发问题。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'hello'</span>.lastIndexOf(<span class="string">'e'</span>); <span class="comment">// Noncompliant</span></span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> char = <span class="string">'hello'</span>.lastIndexOf(<span class="string">'e'</span>);</span><br></pre></td></tr></table></figure></p>
<p>违反此规则的代码中，使用<code>map</code>进行循环的情况最多，如果不需要循环返回值，请使用<code>forEach</code>代替。</p>
<h2>不应重复声明变量和函数（<a href="https://rules.sonarsource.com/javascript/RSPEC-2814" target="_blank" rel="noopener">Variables and functions should not be redeclared</a>）</h2>
<p>实际上，可以多次使用相同的符号作为变量或函数，但这样做可能会使维护者感到困惑。此外，这种重新分配可能是错误的，开发人员没有意识到变量的值被新的分配覆盖了。</p>
<p>此规则也适用于函数参数。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">'foo'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;&#125; <span class="comment">// Noncompliant</span></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// prints "foo"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> arg = <span class="string">'event'</span>; <span class="comment">// Noncompliant, argument value is lost</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fun(); <span class="comment">// prints "bar"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'foo'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fun(); <span class="comment">// prints "bar"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Noncompliant</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'bar'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fun(); <span class="comment">// prints "bar"</span></span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">'foo'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">otherName</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> newName = <span class="string">'event'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fun(); <span class="comment">// prints "foo"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  print(<span class="string">'foo'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fun(); <span class="comment">// prints "foo"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printBar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  print(<span class="string">'bar'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">printBar(); <span class="comment">// prints "bar"</span></span><br></pre></td></tr></table></figure></p>
<h2>数组方法的回调应该有返回（return 语句）（<a href="https://rules.sonarsource.com/javascript/RSPEC-3796" target="_blank" rel="noopener">Callbacks of array methods should have return statements</a>）</h2>
<p>JavaScript 中的数组有几种（过滤、映射或折叠）需要回调的方法。在这样的回调函数中没有 return 语句很可能是一个错误，因为数组的处理使用了回调的返回值。 如果没有返回，回调将隐式返回 undefined，这可能会失败。</p>
<p>此规则适用于数组的以下方法：</p>
<ul>
<li><code>Array.from</code></li>
<li><code>Array.prototype.every</code></li>
<li><code>Array.prototype.filter</code></li>
<li><code>Array.prototype.find</code></li>
<li><code>Array.prototype.findIndex</code></li>
<li><code>Array.prototype.map</code></li>
<li><code>Array.prototype.reduce</code></li>
<li><code>Array.prototype.reduceRight</code></li>
<li><code>Array.prototype.some</code></li>
<li><code>Array.prototype.sort</code></li>
</ul>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">let</span> merged = arr.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  a.concat(b);</span><br><span class="line">&#125;); <span class="comment">// Noncompliant: No return statement, will result in TypeError</span></span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">let</span> merged = arr.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a.concat(b);</span><br><span class="line">&#125;); <span class="comment">// merged === "abc"</span></span><br></pre></td></tr></table></figure></p>
<p>违反此规则的代码中，使用<code>map</code>进行循环的情况最多，如果不需要循环返回值，请使用<code>forEach</code>代替。</p>
<h2>严格相等运算符不应与不同类型一起使用（<a href="https://rules.sonarsource.com/javascript/RSPEC-3403" target="_blank" rel="noopener">Strict equality operators should not be used with dissimilar types</a>）</h2>
<p>使用严格相等运算符 <code>===</code> 和 <code>!==</code> 比较不同的类型将始终返回相同的值，分别为 <code>false</code> 和 <code>true</code>，因为在比较之前没有进行类型转换。因此，这种比较是错误的。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">8</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="string">'8'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Noncompliant; always false</span></span><br><span class="line"><span class="keyword">if</span> (a === b) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">8</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="string">'8'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (a == b) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">8</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="string">'8'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (a === <span class="built_in">Number</span>(b)) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>“switch”语句应该至少有 3 个“case”子句（<a href="https://rules.sonarsource.com/javascript/RSPEC-1301" target="_blank" rel="noopener">&quot;switch&quot; statements should have at least 3 &quot;case&quot; clauses</a>）</h2>
<p>当同一个表达式的值有许多不同的情况时，switch 语句很有用。但是，对于一两种情况，使用 if 语句会使代码更具可读性。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (variable) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">    doSomething();</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    doSomethingElse();</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (variable == <span class="number">0</span>) &#123;</span><br><span class="line">  doSomething();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  doSomethingElse();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>应使用集合和数组内容（<a href="https://rules.sonarsource.com/javascript/RSPEC-4030" target="_blank" rel="noopener">Collection and array contents should be used</a>）</h2>
<p>当一个集合被填充但它的内容从未被使用时，那么它肯定是某种错误。要么重构使集合变得毫无意义，要么缺少访问权限。</p>
<p>当除了添加或删除值的方法之外没有对集合调用任何方法时，此规则会引发问题。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLength</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> strings = []; <span class="comment">// Noncompliant</span></span><br><span class="line">  strings.push(a);</span><br><span class="line">  strings.push(b);</span><br><span class="line">  strings.push(c);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> a.length + b.length + c.length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLength</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a.length + b.length + c.length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>跳转语句不应该是多余的（<a href="https://rules.sonarsource.com/javascript/RSPEC-3626" target="_blank" rel="noopener">Jump statements should not be redundant</a>）</h2>
<p>跳转语句，例如 <code>return</code>、<code>break</code> 和 <code>continue</code> 可以让你改变程序执行的默认流程，但是将控制流引导到原始方向的跳转语句是多余的。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">redundantJump</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (x == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'x == 1'</span>);</span><br><span class="line">    <span class="keyword">return</span>; <span class="comment">// Noncompliant</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">redundantJump</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (x == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'x == 1'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>例外：</p>
<p><code>switch</code> 语句中的 <code>break</code> 和 <code>return</code> 被忽略，因为它们经常用于保持一致性。 <code>continue</code> with label 也会被忽略，因为标签通常用于清晰起见。 此外，块中作为单个语句的跳转语句也将被忽略。</p>
<h2>“await”不应该被重复使用（<a href="https://rules.sonarsource.com/javascript/RSPEC-4326" target="_blank" rel="noopener">&quot;await&quot; should not be used redundantly</a>）</h2>
<p>异步函数总是将返回值包装在 Promise 中。 因此，使用 <code>return await</code> 是多余的。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> foo(); <span class="comment">// Noncompliant</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> foo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>“await”不应该被重复使用（<a href="https://rules.sonarsource.com/javascript/RSPEC-905" target="_blank" rel="noopener">Non-empty statements should change control flow or have at least one side-effect</a>）</h2>
<p>任何没有副作用且不会导致控制流改变的语句（空语句除外，这意味着语句只包含一个分号;）通常会指示编程错误，因此应该重构。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a == <span class="number">1</span>; <span class="comment">// Noncompliant; was assignment intended?</span></span><br><span class="line"><span class="keyword">var</span> msg = <span class="string">"Hello, "</span></span><br><span class="line">  <span class="string">"World!"</span>; <span class="comment">// Noncompliant; have we forgotten '+' operator on previous line?</span></span><br></pre></td></tr></table></figure></p>
<h2>相关的“if/else if”语句不应具有相同的条件（<a href="https://rules.sonarsource.com/javascript/RSPEC-905" target="_blank" rel="noopener">Related &quot;if/else if&quot; statements should not have the same condition</a>）</h2>
<p>从上到下评估 <code>if/else if</code> 语句链。 最多只会执行一个分支：第一个条件为真的分支。</p>
<p>因此，复制条件会自动导致死代码。通常，这是由于复制/粘贴错误造成的。充其量只是死代码，最糟糕的是，它是一个错误，在维护代码时可能会引发更多错误，显然它可能导致意外行为。</p>
<p>请注意，此规则要求 Node.js 在分析期间可用。</p>
<p>反例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (param == <span class="number">1</span>)</span><br><span class="line">  openWindow();</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (param == <span class="number">2</span>)</span><br><span class="line">  closeWindow();</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (param == <span class="number">1</span>)  <span class="comment">// Noncompliant</span></span><br><span class="line">  moveWindowToTheBackground();</span><br></pre></td></tr></table></figure></p>
<p>正例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (param == <span class="number">1</span>)</span><br><span class="line">  openWindow();</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (param == <span class="number">2</span>)</span><br><span class="line">  closeWindow();</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (param == <span class="number">3</span>)</span><br><span class="line">  moveWindowToTheBackground();</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cleam.github.io/2021/09/23/cognitive-complexity/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cleam Lee">
      <meta itemprop="description" content="前端生涯记录总结">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老李">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/09/23/cognitive-complexity/" class="post-title-link" itemprop="https://cleam.github.io/index.html">认知复杂度（cognitive complexity ）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-09-23 09:44:30 / 修改时间：19:51:25" itemprop="dateCreated datePublished" datetime="2021-09-23T09:44:30+08:00">2021-09-23</time>
            

            
              

              
            
          </span>

          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2021/09/23/cognitive-complexity/#SOHUCS" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span id="url::https://cleam.github.io/2021/09/23/cognitive-complexity/" class="cy_cmt_count" data-xid="2021/09/23/cognitive-complexity/" itemprop="commentsCount"></span>
                </a>
              
            
          

          
          

          

          

          

        </span></div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>2021 年 4 月 5 日，1.5 版本</p>
</blockquote>
<h2>摘要</h2>
<p>圈复杂度（Cyclomatic Complexity）最初被表述为对模块控制流的“可测试性和可维护性”的度量。 虽然它擅长测量前者，但其基础数学模型在产生测量后者的值方面并不令人满意。本白皮书描述了一种新指标，它打破了使用数学模型来评估代码的方式，以弥补圈复杂度的缺点，并产生一种更准确地反映理解难度的度量指标，从而更准确地反映维护方法、类和应用程序的相对难度。</p>
<h2>术语解释</h2>
<p>虽然认知复杂度是一种与语言无关的度量标准，它同样适用于文件（files）和类（classes），以及方法（methods）、过程（procedures）、函数（functions）等，但为了方便起见，使用了面向对象的术语“<code>类（class）</code>”和“<code>方法（method）</code>”。</p>
<h2>介绍</h2>
<p>Thomas J. McCabe 的圈复杂度长期以来一直是衡量方法控制流复杂度的事实标准。它最初的目的是“识别难以测试或维护的软件模块”[1]，但虽然它准确计算了完全覆盖一个方法所需的最少测试用例数，但它并不是一个令人满意的可理解性度量。这是因为具有相同圈复杂度的方法不一定给维护者带来相同的难度，导致测量通过高估某些结构而低估其他结构的“假象”。</p>
<p>同时，圈复杂度不再是全面的。它于 1976 年在 Fortran 环境中制定，不包括现代语言结构，如<code>try/catch</code>和<code>lambdas</code>。</p>
<p>最后，因为每个方法的最小圈复杂度分数为 1，所以不可能知道任何具有高聚合圈复杂度的给定类是属于大型的、易于维护的类还是具有复杂控制流的小类。除了<code>类级别</code>之外，人们普遍认为应用程序的圈复杂度分数与其代码行总数相关。换句话说，圈复杂度在<code>方法级别</code>之上几乎没有用处。</p>
<p>作为这些问题的补救措施，认知复杂度（Cognitive Complexity）已被制定于解决现代语言结构，并在类和应用程序级别产生有意义的值。更重要的是，它脱离了基于数学模型评估代码的实践，因此它可以产生与程序员对理解这些流程所需的心理或认知相对应的控制流评估。</p>
<h2>举例说明</h2>
<p>以它旨在解决的问题为例，开始讨论认知复杂性是很有用的。 以下两种方法具有相同的圈复杂度，但在可理解性方面却截然不同。</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例1：</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sumOfPrimes</span><span class="params">(<span class="keyword">int</span> max)</span> </span>&#123; <span class="comment">// +1</span></span><br><span class="line">  <span class="keyword">int</span> total = <span class="number">0</span>;</span><br><span class="line">  OUT: <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= max; ++i) &#123; <span class="comment">// +1</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span>; j &lt; i; ++j) &#123; <span class="comment">// +1</span></span><br><span class="line">      <span class="keyword">if</span> (i % j == <span class="number">0</span>) &#123; <span class="comment">// +1</span></span><br><span class="line">        <span class="keyword">continue</span> OUT;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    total += i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> total;</span><br><span class="line">&#125; <span class="comment">// Cyclomatic Complexity 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例2：</span></span><br><span class="line"><span class="function">String <span class="title">getWords</span><span class="params">(<span class="keyword">int</span> number)</span> </span>&#123; <span class="comment">// +1</span></span><br><span class="line">  <span class="keyword">switch</span> (number) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>: <span class="comment">// +1</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">"one"</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>: <span class="comment">// +1</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">"a couple"</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>: <span class="comment">// +1</span></span><br><span class="line">      <span class="keyword">return</span> “a few”;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"lots"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="comment">// Cyclomatic Complexity 4</span></span><br></pre></td></tr></table></figure></p>
<p>**圈复杂度（Cyclomatic Complexity）<strong>底层的数学模型赋予这两种方法同等的权重，但从直观上看，<code>sumOfPrimes</code>的控制流程比<code>getWords</code>的控制流程更难理解。 这就是为什么</strong>认知复杂度（Cognitive Complexity）**放弃使用数学模型来评估控制流，转而使用一组简单的规则将程序员的直觉转化为数字。</p>
<h2>（衡量）基本标准和方法</h2>
<p>认知复杂度分数根据三个基本规则进行评估：</p>
<ol>
<li><strong>忽略</strong>允许将多个语句易于理解地<strong>简写</strong>成一个的情况</li>
<li>在代码线性流程中的每一次中断都增加（+1）（复杂度）</li>
<li>断流结构嵌套时增加（复杂度）</li>
</ol>
<p>此外，复杂性分数由四种不同类型的增量组成：</p>
<p>A. 嵌套（Nesting） - 评估在彼此内部嵌套控制流结构
B. 结构化（Structural） - 对受嵌套增量影响并增加嵌套计数的控制流结构进行评估
C. 基本（Fundamental） - 评估不受嵌套增量约束的语句
D. 混合（Hybrid） - 对不受嵌套增量影响但确实增加嵌套计数的控制流结构进行评估</p>
<p>虽然增量的类型在数学上没有区别 - 每个增量都会在最终分数上+1 - 区分正在计算的特征类别可以更容易地理解嵌套增量适用和不适用的地方。</p>
<p>这些规则及其背后的原则将在以下各节中进一步详述。</p>
<h2>忽略简写</h2>
<p>制定认知复杂度的一个指导原则是它应该激励良好的编码实践。也就是说，它应该忽略或忽略使代码更具可读性的功能。</p>
<p>方法结构本身就是一个很好的例子。将代码分解成方法允许您将多个语句压缩成一个单一的、令人回味的命名调用，即“简写”它。因此，方法的认知复杂度不会增加。</p>
<p>认知复杂度还忽略了在许多语言中发现的空合并运算符，同样是因为它们允许将多行代码简写为一行。 例如，以下两个代码示例执行相同的操作：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例1：</span></span><br><span class="line">MyObj myObj = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (a != <span class="keyword">null</span>) &#123;</span><br><span class="line">   myObj = a.myObj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 示例2：</span></span><br><span class="line">MyObj myObj = a?.myObj;</span><br></pre></td></tr></table></figure></p>
<p>示例 1 的含义需要一点时间来处理，而一旦您理解了空合并语法，示例 2 的含义就会立即清晰。 出于这个原因，认知复杂度会忽略空合并运算符。</p>
<h2>线性流中断的增量（Increment for breaks in the linear flow）</h2>
<p>认知复杂度的另一个指导原则是，（从上到下、从左到右的正常线性流程中的）破坏性代码结构会增加维护人员的理解难度。为了承认这种额外的努力，认知复杂度评估了以下方面的结构增量：</p>
<ul>
<li>循环：<code>for, while, do while, ...</code></li>
<li>条件：<code>三元运算符、if, #if, #ifdef, ...</code></li>
</ul>
<p>评估混合增量：</p>
<ul>
<li><code>else if, elif, else, …</code></li>
</ul>
<p>它没有评估这些结构的嵌套增量，因为在阅读<code>if</code>时已经计算了认知成本。（No nesting increment is assessed for these structures because the mental cost has already been paid when reading the if.）</p>
<p>对于习惯了圈复杂度的人来说，这些增量目标似乎很熟悉。此外，认知复杂度也会增加：</p>
<p><strong>Catches</strong>：</p>
<p><code>catch</code>和<code>if</code>一样代表控制流中的一种分支。因此，每个<code>catch</code>子句都会导致认知复杂度的增加。请注意，无论<code>catch</code>到多少异常，<code>catch</code>都只会为认知复杂度增加 1 分。<code>try</code>和<code>finally</code>块被完全忽略。</p>
<p><strong>Switches</strong>：</p>
<p>一个<code>switch</code>和它所有的<code>case</code>组合在一起会产生一个单一的结构增量。</p>
<p>在圈复杂度下，<code>switch</code>被视为<code>if-else if 链</code>的模拟。也就是说，<code>switch</code>中的每种情况都会导致增量，因为它会导致控制流的数学模型中出现分支。</p>
<p>但是从维护者的角度来看，一个<code>switch</code> —— 将单个变量与一组明确命名的文字值进行比较 —— 比 <code>if-else if 链</code>更容易理解，因为后者可以使用任意数量的变量和值进行任意数量的比较。</p>
<p>简而言之，<code>if-else if 链</code>（结构的代码）必须仔细阅读，而<code>switch</code>通常可以一目了然。</p>
<p><strong>Sequences of logical operators（逻辑运算符序列）</strong>：</p>
<p>出于类似的原因，认知复杂度不会因每个二元逻辑运算符而增加。相反，它评估每个二元逻辑运算符序列的基本增量。 例如：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例1：</span></span><br><span class="line">a &amp;&amp; b</span><br><span class="line">a &amp;&amp; b &amp;&amp; c &amp;&amp; d</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例2：</span></span><br><span class="line">a || b</span><br><span class="line">a || b || c || d</span><br></pre></td></tr></table></figure></p>
<p>理解上述 2 个示例中的第二行并不比理解第一行难。 另一方面，理解以下两行却有显着差异：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a &amp;&amp; b &amp;&amp; c &amp;&amp; d</span><br><span class="line">a || b &amp;&amp; c || d</span><br></pre></td></tr></table></figure></p>
<p>因为混合运算符使布尔表达式变得更加难以理解，因此对于类似运算符的每个新序列，认知复杂度都会增加。 例如：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a         <span class="comment">// +1 for `if`</span></span><br><span class="line">  &amp;&amp; b &amp;&amp; c   <span class="comment">// +1</span></span><br><span class="line">  || d || e   <span class="comment">// +1</span></span><br><span class="line">  &amp;&amp; f)       <span class="comment">// +1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (a         <span class="comment">// +1 for `if`</span></span><br><span class="line">  &amp;&amp;          <span class="comment">// +1</span></span><br><span class="line">  !(b &amp;&amp; c))  <span class="comment">// +1</span></span><br></pre></td></tr></table></figure></p>
<p>虽然认知复杂度为相对于圈复杂度的类似运算符提供了“折扣”，但它确实会增加所有二进制布尔运算符序列，例如变量赋值、方法调用和返回语句中的运算符。</p>
<p><strong>Recursion（递归）</strong>：</p>
<p>与圈复杂度不同，无论是直接的还是间接的，认知复杂度为递归循环中的每个方法添加一个基本增量。 这个决定有两个动机。 首先，递归代表一种“元循环”，并且循环的认知复杂度递增。其次，认知复杂度是关于估计理解一个方法的控制流的相对难度，甚至一些经验丰富的程序员也发现递归难以理解。</p>
<p><strong>Jumps to labels（跳转标签）</strong>：</p>
<p><code>goto</code>为认知复杂度添加了一个基本增量，就像<code>break</code>或<code>continue</code>到标签和其他多级跳转，例如<code>break</code>或<code>continue</code>到某些语言中的数字。但是因为提前返回通常可以使代码更清晰，所以其他跳转或提前退出不会导致增量。</p>
<h2>嵌套断流结构的增量（Increment for nested flow-break structures）</h2>
<p>从直觉上看，五个 if 和 for 结构的线性系列比连续嵌套的五个相同的结构更容易理解，无论通过每个系列的执行路径的数量如何。 由于这种嵌套增加了理解代码的心理需求，因此认知复杂度评估了它的嵌套增量。</p>
<p>具体来说，每次导致结构或混合增量的结构嵌套在另一个这样的结构中时，每个嵌套级别都会添加一个嵌套增量。例如，在以下示例中，方法本身或<code>try</code>没有嵌套增量，因为这两种结构都不会导致结构性增量或混合增量：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myMethod</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (condition1) &#123; <span class="comment">// +1</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123; <span class="comment">// +2 (nesting=1)</span></span><br><span class="line">        <span class="keyword">while</span> (condition2) &#123; … &#125; <span class="comment">// +3 (nesting=2)</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (ExcepType1 | ExcepType2 e) &#123; <span class="comment">// +1</span></span><br><span class="line">    <span class="keyword">if</span> (condition2) &#123; … &#125; <span class="comment">// +2 (nesting=1)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="comment">// Cognitive Complexity 9</span></span><br></pre></td></tr></table></figure></p>
<p>但是，<code>if、for、while 和 catch</code>结构都受结构和嵌套增量的影响。</p>
<p>此外，虽然顶级方法被忽略，并且 lambdas、嵌套方法和类似功能没有结构增量，但当嵌套在其他类似方法的结构中时，这些方法确实会增加嵌套级别：</p>
<p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myMethod2</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  Runnable r = () -&gt; &#123; <span class="comment">// +0 (but nesting level is now 1)</span></span><br><span class="line">    <span class="keyword">if</span> (condition1) &#123; … &#125; <span class="comment">// +2 (nesting=1)</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125; <span class="comment">// Cognitive Complexity 2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#if DEBUG // +1 for if</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myMethod2</span> <span class="params">()</span> </span>&#123; <span class="comment">// +0 (nesting level is still 0)</span></span><br><span class="line">  Runnable r = () -&gt; &#123; <span class="comment">// +0 (but nesting level is now 1)</span></span><br><span class="line">    <span class="keyword">if</span> (condition1) &#123; … &#125; <span class="comment">// +3 (nesting=2)</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125; <span class="comment">// Cognitive Complexity 4</span></span><br><span class="line">#endif</span><br></pre></td></tr></table></figure></p>
<h2>影响</h2>
<p>制定认知复杂度的主要目标是计算更准确地反映方法的相对可理解性的方法分数，其次要目标是解决现代语言结构并产生在方法层面上有价值的指标。显然，解决现代语言结构的目标已经实现。下面检查另外两个目标。</p>
<h3>直观的“正确”复杂度分数（Intuitively ‘right’ complexity scores）</h3>
<p>这个讨论从一对具有相同圈复杂度但明显不同的可理解性的方法开始。 现在是时候重新检查这些方法并计算它们的认知复杂性分数了：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sumOfPrimes</span><span class="params">(<span class="keyword">int</span> max)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> total = <span class="number">0</span>;</span><br><span class="line">  OUT: <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= max; ++i) &#123; <span class="comment">// +1</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span>; j &lt; i; ++j) &#123; <span class="comment">// +2</span></span><br><span class="line">      <span class="keyword">if</span> (i % j == <span class="number">0</span>) &#123; <span class="comment">// +3</span></span><br><span class="line">        <span class="keyword">continue</span> OUT; <span class="comment">// +1</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    total += i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> total;</span><br><span class="line">&#125; <span class="comment">// Cognitive Complexity 7</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">String <span class="title">getWords</span><span class="params">(<span class="keyword">int</span> number)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (number) &#123; <span class="comment">// +1</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"one"</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"a couple"</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      <span class="keyword">return</span> “a few”;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"lots"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="comment">// Cognitive Complexity 1</span></span><br></pre></td></tr></table></figure></p>
<p>认知复杂度算法为这两种方法给出了明显不同的分数，这些分数更能反映它们的相对可理解性。</p>
<h3>高于方法级别的有价值的指标（Metrics that are valuable above the method level）</h3>
<p>此外，由于认知复杂度不会因方法结构而增加，因此聚合数字变得有用。现在，您可以通过简单地比较它们的度量值来区分域类（具有大量简单的<code>getter</code>和<code>setter</code>的类）和包含复杂控制流的类之间的区别。因此，认知复杂度成为衡量类和应用程序相对可理解性的工具。</p>
<h2>总结（Conclusion）</h2>
<p>编写和维护代码的过程是人工过程。它们的输出必须符合数学模型，但它们本身并不适合数学模型。这就是为什么数学模型不足以评估它们所需的努力。</p>
<p>认知复杂度打破了使用数学模型来评估软件可维护性的做法。它从<strong>圈复杂度</strong>设定的先例开始，但使用人类判断来评估应该如何计算结构，并决定应该将什么添加到整个模型中。因此，它产生的方法复杂性分数让程序员觉得比以前的模型更公平的可理解性相对评估。此外，由于认知复杂度不收取方法的“入门成本”，因此它不仅在方法级别，而且在类和应用程序级别都会产生更公平的相对评估。</p>
<blockquote>
<p>[1] Thomas J. McCabe, “A Complexity Measure”, IEEE Transactions on Software Engineering, Vol. SE-2, No. 4, December 1976</p>
</blockquote>
<h2>示例</h2>
<p>一个 YUI 的 js 示例：</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">save: <span class="function"><span class="keyword">function</span> (<span class="params">options, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> options === <span class="string">'function'</span>) &#123;  <span class="comment">// +1</span></span><br><span class="line">    callback = options;</span><br><span class="line">    options = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  options || (options = &#123;&#125;); <span class="comment">// +1</span></span><br><span class="line">  self._validate(self.toJSON(), <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123; <span class="comment">// +2 (nesting = 1)</span></span><br><span class="line">      callback &amp;&amp; callback.call(<span class="literal">null</span>, err); <span class="comment">// +1</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    self.sync(</span><br><span class="line">      self.isNew() ? <span class="string">'create'</span> : <span class="string">'update'</span>, <span class="comment">// +2 (nesting = 1)</span></span><br><span class="line">      options,</span><br><span class="line">      <span class="function"><span class="keyword">function</span> (<span class="params">err, response</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> facade = &#123;</span><br><span class="line">            options: options,</span><br><span class="line">            response: response,</span><br><span class="line">          &#125;,</span><br><span class="line">          parsed;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123; <span class="comment">// +3 (nesting = 2)</span></span><br><span class="line">          facade.error = err;</span><br><span class="line">          facade.src = <span class="string">'save'</span>;</span><br><span class="line">          self.fire(EVT_ERROR, facade);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// +1</span></span><br><span class="line">          <span class="keyword">if</span> (!self._saveEvent) &#123; <span class="comment">// +4 (nesting = 3)</span></span><br><span class="line">            self._saveEvent = self.publish(EVT_SAVE, &#123;</span><br><span class="line">              preventable: <span class="literal">false</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (response) &#123; <span class="comment">// +4 (nesting = 3)</span></span><br><span class="line">            parsed = facade.parsed = self._parse(response);</span><br><span class="line">            self.setAttrs(parsed, options);</span><br><span class="line">          &#125;</span><br><span class="line">          self.changed = &#123;&#125;;</span><br><span class="line">          self.fire(EVT_SAVE, facade);</span><br><span class="line">        &#125;</span><br><span class="line">        callback &amp;&amp; callback.apply(<span class="literal">null</span>, <span class="built_in">arguments</span>); <span class="comment">// +1</span></span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> self;</span><br><span class="line">&#125; <span class="comment">// total complexity = 20</span></span><br></pre></td></tr></table></figure></p>
<h2>附录 A：Compensating Usages</h2>
<blockquote>
<p>todo...</p>
</blockquote>
<h2>附录 B：Specification（标准）</h2>
<p>本节的目的是简要列举增加认知复杂度的结构和情况，但附录 A 中列出的例外情况除外。这是一个全面的列表，而不是详尽无遗的。也就是说，如果一种语言对关键字有一个非典型的拼写，例如<code>elif</code>和<code>else if</code>，这里的省略并不是为了从规范中省略它。</p>
<h3>B1. 增量</h3>
<p>以下各项都有一个增量：</p>
<ul>
<li><code>if</code>, <code>else if</code>, <code>else</code>, <code>三元运算符</code></li>
<li><code>switch</code></li>
<li><code>for</code>, <code>foreach</code></li>
<li><code>while</code>, <code>do while</code></li>
<li><code>catch</code></li>
<li><code>goto LABEL</code>, <code>break LABEL</code>, <code>continue LABEL</code>, <code>break NUMBER</code>, <code>continue NUMBER</code></li>
<li>二元逻辑运算符序列（sequences of binary logical operators）</li>
<li>递归循环中的每个方法（each method in a recursion cycle）</li>
</ul>
<h3>B2. 嵌套级别</h3>
<p>以下结构增加嵌套级别：</p>
<ul>
<li><code>if</code>, <code>else if</code>, <code>else</code>, <code>三元运算符</code></li>
<li><code>switch</code></li>
<li><code>for</code>, <code>foreach</code></li>
<li><code>while</code>, <code>do while</code></li>
<li><code>catch</code></li>
<li>嵌套方法和类似方法的结构，例如<code>lambda</code>（nested methods and method-like structures such as lambdas）</li>
</ul>
<h3>B3. 嵌套增量</h3>
<p>以下结构接收与它们在 B2 结构内的嵌套深度相称的嵌套增量：</p>
<ul>
<li><code>if</code>, <code>三元运算符</code></li>
<li><code>switch</code></li>
<li><code>for</code>, <code>foreach</code></li>
<li><code>while</code>, <code>do while</code></li>
<li><code>catch</code></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cleam.github.io/2021/09/10/Gitlab-CI-CD之-gitlab-ci-yml复用类配置/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cleam Lee">
      <meta itemprop="description" content="前端生涯记录总结">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老李">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/09/10/Gitlab-CI-CD之-gitlab-ci-yml复用类配置/" class="post-title-link" itemprop="https://cleam.github.io/index.html">Gitlab CI/CD之.gitlab-ci.yml复用类配置</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-09-10 16:56:44" itemprop="dateCreated datePublished" datetime="2021-09-10T16:56:44+08:00">2021-09-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-09-28 20:13:21" itemprop="dateModified" datetime="2021-09-28T20:13:21+08:00">2021-09-28</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2021/09/10/Gitlab-CI-CD之-gitlab-ci-yml复用类配置/#SOHUCS" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span id="url::https://cleam.github.io/2021/09/10/Gitlab-CI-CD之-gitlab-ci-yml复用类配置/" class="cy_cmt_count" data-xid="2021/09/10/Gitlab-CI-CD之-gitlab-ci-yml复用类配置/" itemprop="commentsCount"></span>
                </a>
              
            
          

          
          

          

          

          

        </span></div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>复用类配置：</p>
<h2>锚点 Anchors</h2>
<p>YAML 有一项名为“锚点”的功能，您可以使用它在整个文档中复制内容。</p>
<p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cache:</span> <span class="meta">&amp;global_cache</span> <span class="comment"># 定义一个全局缓存的锚点：global_cache</span></span><br><span class="line"><span class="attr">  untracked:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  key:</span> <span class="string">$CI_COMMIT_REF_SLUG</span></span><br><span class="line"><span class="attr">  paths:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">node_modules/</span></span><br><span class="line"><span class="attr">  policy:</span> <span class="string">pull-push</span></span><br><span class="line"></span><br><span class="line"><span class="attr">install:</span></span><br><span class="line"><span class="attr">  cache:</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="meta">*global_cache</span> <span class="comment"># 将global_cache合并到当前配置中</span></span><br><span class="line"><span class="attr">    policy:</span> <span class="string">push</span></span><br><span class="line"></span><br><span class="line"><span class="attr">lint:</span></span><br><span class="line"><span class="attr">  cache:</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="meta">*global_cache</span> <span class="comment"># 将global_cache合并到当前配置中</span></span><br></pre></td></tr></table></figure></p>
<p><code>&amp;</code>设置锚点的名称 (global_cache)，<code>&lt;&lt;</code>意思是“将给定的哈希对象合并到当前哈希对象中”，<code>*</code>包含命名锚点（如：<code>global_cache</code>）。</p>
<p>这个例子的结果是：</p>
<p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cache:</span> <span class="meta">&amp;global_cache</span> <span class="comment"># 定义一个全局缓存的锚点：global_cache</span></span><br><span class="line"><span class="attr">  untracked:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  key:</span> <span class="string">$CI_COMMIT_REF_SLUG</span></span><br><span class="line"><span class="attr">  paths:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">node_modules/</span></span><br><span class="line"><span class="attr">  policy:</span> <span class="string">pull-push</span></span><br><span class="line"></span><br><span class="line"><span class="attr">install:</span></span><br><span class="line"><span class="attr">  cache:</span></span><br><span class="line"><span class="attr">    untracked:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  key:</span> <span class="string">$CI_COMMIT_REF_SLUG</span></span><br><span class="line"><span class="attr">  paths:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">node_modules/</span></span><br><span class="line"><span class="attr">  policy:</span> <span class="string">push</span></span><br><span class="line"></span><br><span class="line"><span class="attr">lint:</span></span><br><span class="line"><span class="attr">  cache:</span></span><br><span class="line"><span class="attr">    untracked:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    key:</span> <span class="string">$CI_COMMIT_REF_SLUG</span></span><br><span class="line"><span class="attr">    paths:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">node_modules/</span></span><br><span class="line"><span class="attr">    policy:</span> <span class="string">pull-push</span></span><br></pre></td></tr></table></figure></p>
<p>你还可以使用锚点来定义两个服务集合。例如以下示例（<code>test:postgres</code>和<code>test:mysql</code>共享了<code>.job_template</code>的<code>script</code>，但是却有这不同的<code>services</code>，分别定义在了<code>.postgres_services</code>和<code>.mysql_services</code>中）：。</p>
<p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">.job_template:</span> <span class="meta">&amp;job_configuration</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">test</span> <span class="string">project</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="string">.postgres_services:</span></span><br><span class="line"><span class="attr">  services:</span> <span class="meta">&amp;postgres_configuration</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">postgres</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ruby</span></span><br><span class="line"></span><br><span class="line"><span class="string">.mysql_services:</span></span><br><span class="line"><span class="attr">  services:</span> <span class="meta">&amp;mysql_configuration</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">mysql</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ruby</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test:</span><span class="attr">postgres:</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*job_configuration</span></span><br><span class="line"><span class="attr">  services:</span> <span class="meta">*postgres_configuration</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">postgres</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test:</span><span class="attr">mysql:</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*job_configuration</span></span><br><span class="line"><span class="attr">  services:</span> <span class="meta">*mysql_configuration</span></span><br></pre></td></tr></table></figure></p>
<p>得到的结果将是这样的：</p>
<p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">.job_template:</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">test</span> <span class="string">project</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="string">.postgres_services:</span></span><br><span class="line"><span class="attr">  services:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">postgres</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ruby</span></span><br><span class="line"></span><br><span class="line"><span class="string">.mysql_services:</span></span><br><span class="line"><span class="attr">  services:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">mysql</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ruby</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test:</span><span class="attr">postgres:</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">test</span> <span class="string">project</span></span><br><span class="line"><span class="attr">  services:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">postgres</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ruby</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">postgres</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test:</span><span class="attr">mysql:</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">test</span> <span class="string">project</span></span><br><span class="line"><span class="attr">  services:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">mysql</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ruby</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure></p>
<p>我们可以看到隐藏的作业被方便地用作模板，并且<code>tags: [postgres]</code> 覆盖了<code>tags: [dev]</code>。</p>
<p><strong>更多锚点的使用示例</strong>：</p>
<ol>
<li>YAML 锚点用于脚本（script）中：</li>
</ol>
<p>您可以将 YAML 锚点与 <code>script</code>、<code>before_script</code> 和 <code>after_script</code> 结合使用，以便在多个作业中使用预定义的命令：</p>
<p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">.some-script-before:</span> <span class="string">&amp;some-script-before</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">echo</span> <span class="string">"Execute this script first"</span></span><br><span class="line"></span><br><span class="line"><span class="string">.some-script:</span> <span class="string">&amp;some-script</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">echo</span> <span class="string">"Execute this script second"</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">echo</span> <span class="string">"Execute this script too"</span></span><br><span class="line"></span><br><span class="line"><span class="string">.some-script-after:</span> <span class="string">&amp;some-script-after</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">echo</span> <span class="string">"Execute this script last"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job1:</span></span><br><span class="line"><span class="attr">  before_script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">*some-script-before</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">*some-script</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"Execute something, for this job only"</span></span><br><span class="line"><span class="attr">  after_script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">*some-script-after</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job2:</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">*some-script-before</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">*some-script</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"Execute something else, for this job only"</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">*some-script-after</span></span><br></pre></td></tr></table></figure></p>
<ol start="2">
<li>YAML 锚点用于用于变量（variables）中：</li>
</ol>
<p>使用带有变量的 YAML 锚点在多个作业中重复分配变量。当作业需要特定的变量块时，您还可以使用 YAML 锚点，否则会<strong>覆盖全局变量</strong>。以下示例显示如何覆盖 <code>GIT_STRATEGY</code> 变量而不影响 <code>SAMPLE_VARIABLE</code> 变量的使用：</p>
<p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># global variables</span></span><br><span class="line"><span class="attr">variables:</span> <span class="string">&amp;global-variables</span></span><br><span class="line"><span class="attr">  SAMPLE_VARIABLE:</span> <span class="string">sample_variable_value</span></span><br><span class="line"><span class="attr">  ANOTHER_SAMPLE_VARIABLE:</span> <span class="string">another_sample_variable_value</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># a job that must set the GIT_STRATEGY variable, yet depend on global variables</span></span><br><span class="line"><span class="attr">job_no_git_strategy:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">cleanup</span></span><br><span class="line"><span class="attr">  variables:</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="string">*global-variables</span></span><br><span class="line"><span class="attr">    GIT_STRATEGY:</span> <span class="string">none</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">echo</span> <span class="string">$SAMPLE_VARIABLE</span></span><br></pre></td></tr></table></figure></p>
<h2>引用 !reference</h2>
<p>使用 <code>!reference</code> 自定义 YAML 标签从其他作业部分选择关键字配置，并在当前部分中复用它。与锚点不同，您可以使用 <code>!reference</code> 标签来复用通过<code>include</code>引用的配置文件中的配置。</p>
<p>在以下示例中，<code>test</code>作业中重复使用了来自两个不同位置的<code>script</code>和<code>after_script</code>：</p>
<ul>
<li><code>setup.yml</code>:</li>
</ul>
<p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">.setup:</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">creating</span> <span class="string">environment</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>.gitlab-ci.yml</code>:</li>
</ul>
<p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">include:</span></span><br><span class="line"><span class="attr">  - local:</span> <span class="string">setup.yml</span></span><br><span class="line"></span><br><span class="line"><span class="string">.teardown:</span></span><br><span class="line"><span class="attr">  after_script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">deleting</span> <span class="string">environment</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test:</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="type">!reference</span> <span class="string">[.setup,</span> <span class="string">script]</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">running</span> <span class="string">my</span> <span class="string">own</span> <span class="string">command</span></span><br><span class="line"><span class="attr">  after_script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="type">!reference</span> <span class="string">[.teardown,</span> <span class="string">after_script]</span></span><br></pre></td></tr></table></figure></p>
<p>在以下示例中，<code>test-vars-1</code> 复用 <code>.vars</code> 中的所有变量，而 <code>test-vars-2</code> 选择特定变量并将其复用为新的 <code>MY_VAR</code> 变量。</p>
<p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">.vars:</span></span><br><span class="line"><span class="attr">  variables:</span></span><br><span class="line"><span class="attr">    URL:</span> <span class="string">'http://my-url.internal'</span></span><br><span class="line"><span class="attr">    IMPORTANT_VAR:</span> <span class="string">'the details'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test-vars-1:</span></span><br><span class="line"><span class="attr">  variables:</span> <span class="type">!reference</span> <span class="string">[.vars,</span> <span class="string">variables]</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">printenv</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test-vars-2:</span></span><br><span class="line"><span class="attr">  variables:</span></span><br><span class="line"><span class="attr">    MY_VAR:</span> <span class="type">!reference</span> <span class="string">[.vars,</span> <span class="string">variables,</span> <span class="string">IMPORTANT_VAR]</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">printenv</span></span><br></pre></td></tr></table></figure></p>
<p>您不能重复使用已经包含 <code>!reference</code> 标签的部分。仅支持一层嵌套。</p>
<h2>继承 extend</h2>
<p>使用<code>extends</code>来复用配置块。它是锚点（Anchor）的替代品，并且更加灵活和可读。您可以使用<code>extends</code>来复用通过<code>include</code>引用的配置文件中的配置。</p>
<p>在以下示例中，<code>rspec</code> 作业使用 <code>.tests</code> 模板作业中的配置。GitLab：</p>
<ul>
<li>根据键执行反向深度合并。</li>
<li>将 <code>.tests</code> 内容与 <code>rspec</code> 作业合并。</li>
<li>不合并键的值。</li>
</ul>
<p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">.tests:</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">rake</span> <span class="string">test</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="attr">    refs:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">branches</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rspec:</span></span><br><span class="line"><span class="attr">  extends:</span> <span class="string">.tests</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">rake</span> <span class="string">rspec</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="attr">    variables:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">$RSPEC</span></span><br></pre></td></tr></table></figure></p>
<p><code>rspec</code>作业的结果是：</p>
<p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rspec:</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">rake</span> <span class="string">rspec</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="attr">    refs:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">branches</span></span><br><span class="line"><span class="attr">    variables:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">$RSPEC</span></span><br></pre></td></tr></table></figure></p>
<p>本例中的 <code>.tests</code> 是一个<a href="https://docs.gitlab.com/ee/ci/yaml/#hide-jobs" target="_blank" rel="noopener">隐藏作业</a>，但也可以从常规作业中<code>extends</code>配置。</p>
<p><code>extends</code> 支持多级继承。 虽然您可以使用多达 11 个级别，但是您应该避免使用 3 个以上的级别。以下示例具有两个继承级别：</p>
<p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">.tests:</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">    - if:</span> <span class="string">$CI_PIPELINE_SOURCE</span> <span class="string">==</span> <span class="string">"push"</span></span><br><span class="line"></span><br><span class="line"><span class="string">.rspec:</span></span><br><span class="line"><span class="attr">  extends:</span> <span class="string">.tests</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">rake</span> <span class="string">rspec</span></span><br><span class="line"></span><br><span class="line"><span class="string">rspec</span> <span class="number">1</span><span class="string">:</span></span><br><span class="line"><span class="attr">  variables:</span></span><br><span class="line"><span class="attr">    RSPEC_SUITE:</span> <span class="string">'1'</span></span><br><span class="line"><span class="attr">  extends:</span> <span class="string">.rspec</span></span><br><span class="line"></span><br><span class="line"><span class="string">rspec</span> <span class="number">2</span><span class="string">:</span></span><br><span class="line"><span class="attr">  variables:</span></span><br><span class="line"><span class="attr">    RSPEC_SUITE:</span> <span class="string">'2'</span></span><br><span class="line"><span class="attr">  extends:</span> <span class="string">.rspec</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spinach:</span></span><br><span class="line"><span class="attr">  extends:</span> <span class="string">.tests</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">rake</span> <span class="string">spinach</span></span><br></pre></td></tr></table></figure></p>
<p>在 GitLab 12.0 及更高版本中，也可以使用多个父项进行扩展（extends）。</p>
<p>您可以用<code>extends</code>来合并哈希对象但是不能用来合并数组。用于合并的算法是“就近优先原则（closest scope wins）”，因此来自最后一个成员的键总是覆盖其他级别上定义的任何内容。例如：</p>
<p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">.only-important:</span></span><br><span class="line"><span class="attr">  variables:</span></span><br><span class="line"><span class="attr">    URL:</span> <span class="string">'http://my-url.internal'</span></span><br><span class="line"><span class="attr">    IMPORTANT_VAR:</span> <span class="string">'the details'</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">    - if:</span> <span class="string">$CI_COMMIT_BRANCH</span> <span class="string">==</span> <span class="string">$CI_DEFAULT_BRANCH</span></span><br><span class="line"><span class="attr">    - if:</span> <span class="string">$CI_COMMIT_BRANCH</span> <span class="string">==</span> <span class="string">"stable"</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">production</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"Hello world!"</span></span><br><span class="line"></span><br><span class="line"><span class="string">.in-docker:</span></span><br><span class="line"><span class="attr">  variables:</span></span><br><span class="line"><span class="attr">    URL:</span> <span class="string">'http://docker-url.internal'</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">docker</span></span><br><span class="line"><span class="attr">  image:</span> <span class="string">alpine</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rspec:</span></span><br><span class="line"><span class="attr">  variables:</span></span><br><span class="line"><span class="attr">    GITLAB:</span> <span class="string">'is-awesome'</span></span><br><span class="line"><span class="attr">  extends:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">.only-important</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">.in-docker</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">rake</span> <span class="string">rspec</span></span><br></pre></td></tr></table></figure></p>
<p>结果是：</p>
<p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rspec:</span></span><br><span class="line"><span class="attr">  variables:</span></span><br><span class="line"><span class="attr">    URL:</span> <span class="string">'http://docker-url.internal'</span></span><br><span class="line"><span class="attr">    IMPORTANT_VAR:</span> <span class="string">'the details'</span></span><br><span class="line"><span class="attr">    GITLAB:</span> <span class="string">'is-awesome'</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">    - if:</span> <span class="string">$CI_COMMIT_BRANCH</span> <span class="string">==</span> <span class="string">$CI_DEFAULT_BRANCH</span></span><br><span class="line"><span class="attr">    - if:</span> <span class="string">$CI_COMMIT_BRANCH</span> <span class="string">==</span> <span class="string">"stable"</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">docker</span></span><br><span class="line"><span class="attr">  image:</span> <span class="string">alpine</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">rake</span> <span class="string">rspec</span></span><br></pre></td></tr></table></figure></p>
<p>在上面示例中：</p>
<ul>
<li><code>variables</code>合并，但 <code>URL：&quot;http://docker-url.internal&quot;</code> 覆盖 <code>URL：&quot;http://my-url.internal&quot;</code>。</li>
<li><code>tags：['docker']</code> 覆盖<code>tags：['production']</code>。</li>
<li><code>script</code>不会合并，但 <code>script: ['rake rspec']</code> 会覆盖 <code>script: ['echo &quot;Hello world!&quot;']</code>。 您可以使用锚点来合并数组。</li>
</ul>
<p><strong><code>extends</code> 和 <code>include</code>一起使用</strong>：要复用来自不同配置文件的配置，请结合<code>extends</code> 和 <code>include</code>。</p>
<p>在下面的示例中，在 <code>included.yml</code> 文件中定义了一个脚本<code>script</code>。然后，在 <code>.gitlab-ci.yml</code> 文件中，使用<code>extends</code>继承了那部分脚本内容：</p>
<ul>
<li><code>included.yml</code>:</li>
</ul>
<p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">.template:</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">Hello!</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>.gitlab-ci.yml</code>:</li>
</ul>
<p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">include:</span> <span class="string">included.yml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">useTemplate:</span></span><br><span class="line"><span class="attr">  image:</span> <span class="string">alpine</span></span><br><span class="line"><span class="attr">  extends:</span> <span class="string">.template</span></span><br></pre></td></tr></table></figure></p>
<h2>包含 include</h2>
<blockquote>
<p>TODO...</p>
</blockquote>
<h2>总结&amp;注意</h2>
<p>使用<code>include</code>关键字时，您不能跨多个文件使用 YAML 锚点。锚点只在定义它们的文件中有效。要复用来自不同 YAML 文件的配置，请使用<code>引用（!reference）</code>或<code>继承（extends）</code>。</p>
<blockquote>
<p>英文原文：
锚点 Anchors：https://docs.gitlab.com/ee/ci/yaml/#anchors
引用 !reference：https://docs.gitlab.com/ee/ci/yaml/#reference-tags
继承 extend：https://docs.gitlab.com/ee/ci/yaml/#extends
包含 include：https://docs.gitlab.com/ee/ci/yaml/#include</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cleam.github.io/2021/07/23/Gitlab-CI-CD之-gitlab-ci-yml常用配置说明/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cleam Lee">
      <meta itemprop="description" content="前端生涯记录总结">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老李">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/07/23/Gitlab-CI-CD之-gitlab-ci-yml常用配置说明/" class="post-title-link" itemprop="https://cleam.github.io/index.html">Gitlab CI/CD之.gitlab-ci.yml常用配置说明</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-07-23 14:29:45" itemprop="dateCreated datePublished" datetime="2021-07-23T14:29:45+08:00">2021-07-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-10-09 18:38:35" itemprop="dateModified" datetime="2021-10-09T18:38:35+08:00">2021-10-09</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2021/07/23/Gitlab-CI-CD之-gitlab-ci-yml常用配置说明/#SOHUCS" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span id="url::https://cleam.github.io/2021/07/23/Gitlab-CI-CD之-gitlab-ci-yml常用配置说明/" class="cy_cmt_count" data-xid="2021/07/23/Gitlab-CI-CD之-gitlab-ci-yml常用配置说明/" itemprop="commentsCount"></span>
                </a>
              
            
          

          
          

          

          

          

        </span></div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这里记录着我在配置<code>.gitlab-ci.yml</code>过程中碰到的常用的几个配置，对其进行分类解释说明，方便后续理解与查阅。</p>
<p>我的一个完整的<code>.gitlab-ci.yml</code>示例：</p>
<p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># default stages: .pre build test deploy .post</span></span><br><span class="line"><span class="comment"># my stages: pre test build deploy post</span></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">pre</span> <span class="comment"># install</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">test</span> <span class="comment"># lint, sonar_check, unit_test</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">build</span> <span class="comment"># build, build_with_sentry</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">deploy</span> <span class="comment"># deploy_testing, deploy_production (upload to cdn or server)</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">post</span> <span class="comment"># clean if needed</span></span><br><span class="line"></span><br><span class="line"><span class="attr">variables:</span></span><br><span class="line"><span class="attr">  BUILD_DIR_FOR_TESTING:</span> <span class="string">pre</span></span><br><span class="line"><span class="attr">  BUILD_DIR_FOR_PRODUCTION:</span> <span class="string">dist</span></span><br><span class="line"><span class="attr">  URL_FOR_TESTING:</span> <span class="attr">https://test-demo.example.com/</span></span><br><span class="line"><span class="attr">  URL_FOR_PRODUCTION:</span> <span class="attr">https://demo.example.com/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cache:</span> <span class="meta">&amp;global_cache</span></span><br><span class="line"><span class="attr">  untracked:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  key:</span> <span class="string">$CI_COMMIT_REF_SLUG</span></span><br><span class="line"><span class="attr">  paths:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">node_modules/</span></span><br><span class="line"><span class="attr">  policy:</span> <span class="string">pull-push</span></span><br><span class="line"></span><br><span class="line"><span class="string">.common:</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">gr</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############ stage: pre ############</span></span><br><span class="line"></span><br><span class="line"><span class="attr">install:</span></span><br><span class="line"><span class="attr">  extends:</span> <span class="string">.common</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">pre</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line"><span class="attr">  cache:</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="meta">*global_cache</span></span><br><span class="line"><span class="attr">    policy:</span> <span class="string">push</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">    - if:</span> <span class="string">$CI_COMMIT_REF_NAME</span> <span class="string">=~</span> <span class="string">/^dev$|^master$/</span></span><br><span class="line"><span class="attr">      changes:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">package.json</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">package-lock.json</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">yarn.lock</span></span><br><span class="line"><span class="attr">    - if:</span> <span class="string">$CI_PIPELINE_SOURCE</span> <span class="string">==</span> <span class="string">"merge_request_event"</span> <span class="string">&amp;&amp;</span> <span class="string">$CI_MERGE_REQUEST_TARGET_BRANCH_NAME</span> <span class="string">=~</span> <span class="string">/^dev$|^master$/</span></span><br><span class="line"><span class="attr">      changes:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">package.json</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">package-lock.json</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">yarn.lock</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############ stage: test ############</span></span><br><span class="line"></span><br><span class="line"><span class="attr">lint:</span></span><br><span class="line"><span class="attr">  extends:</span> <span class="string">.common</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">  cache:</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="meta">*global_cache</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"==== 代码校验 ===="</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">lint</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">    - if:</span> <span class="string">$CI_COMMIT_REF_NAME</span> <span class="string">=~</span> <span class="string">/^dev$|^master$/</span></span><br><span class="line"><span class="attr">    - if:</span> <span class="string">$CI_PIPELINE_SOURCE</span> <span class="string">==</span> <span class="string">"merge_request_event"</span> <span class="string">&amp;&amp;</span> <span class="string">$CI_MERGE_REQUEST_TARGET_BRANCH_NAME</span> <span class="string">=~</span> <span class="string">/^dev$|^master$/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">sonar_check:</span></span><br><span class="line"><span class="attr">  extends:</span> <span class="string">.common</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"==== SONAR ANALYSIS ===="</span></span><br><span class="line"><span class="attr">  allow_failure:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  when:</span> <span class="string">manual</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">dev</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############ stage: build ############</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build_testing:</span></span><br><span class="line"><span class="attr">  extends:</span> <span class="string">.common</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">build</span></span><br><span class="line"><span class="attr">  cache:</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="meta">*global_cache</span></span><br><span class="line"><span class="attr">    policy:</span> <span class="string">pull</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"==== 测试构建 ===="</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">pre</span></span><br><span class="line"><span class="attr">  artifacts:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">'$CI_PROJECT_NAME-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA-testing'</span></span><br><span class="line"><span class="attr">    expire_in:</span> <span class="number">1</span> <span class="string">week</span></span><br><span class="line"><span class="attr">    paths:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">$BUILD_DIR_FOR_TESTING/</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build_production:</span></span><br><span class="line"><span class="attr">  extends:</span> <span class="string">.common</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">build</span></span><br><span class="line"><span class="attr">  cache:</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="meta">*global_cache</span></span><br><span class="line"><span class="attr">    policy:</span> <span class="string">pull</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"==== 生产构建 ===="</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br><span class="line"><span class="attr">  artifacts:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">'$CI_PROJECT_NAME-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA-production'</span></span><br><span class="line"><span class="attr">    expire_in:</span> <span class="number">1</span> <span class="string">week</span></span><br><span class="line"><span class="attr">    paths:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">$BUILD_DIR_FOR_PRODUCTION/</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############ stage: deploy ############</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy_testing:</span></span><br><span class="line"><span class="attr">  extends:</span> <span class="string">.common</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"测试环境代码发布"</span></span><br><span class="line"><span class="attr">  after_script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"发布成功："</span><span class="string">$URL_FOR_TESTING</span></span><br><span class="line"><span class="attr">  environment:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">testing</span></span><br><span class="line"><span class="attr">    url:</span> <span class="string">$URL_FOR_TESTING</span></span><br><span class="line"><span class="attr">  when:</span> <span class="string">manual</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy_production:</span></span><br><span class="line"><span class="attr">  extends:</span> <span class="string">.common</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"生产环境代码发布"</span></span><br><span class="line"><span class="attr">  after_script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"发布成功："</span><span class="string">$URL_FOR_PRODUCTION</span></span><br><span class="line"><span class="attr">  environment:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">production</span></span><br><span class="line"><span class="attr">    url:</span> <span class="string">$URL_FOR_PRODUCTION</span></span><br><span class="line"><span class="attr">  when:</span> <span class="string">manual</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">master</span></span><br></pre></td></tr></table></figure></p>
<p><a href="/2021/09/10/Gitlab-CI-CD之-gitlab-ci-yml复用类配置/" title="Gitlab CI/CD之.gitlab-ci.yml复用类配置">Gitlab CI/CD之.gitlab-ci.yml复用类配置</a>：</p>
<ul>
<li>Anchors</li>
<li>!reference</li>
<li>extend</li>
<li>include</li>
</ul>
<p>条件类配置：</p>
<ul>
<li>only</li>
<li>except</li>
<li>rules</li>
<li>when</li>
</ul>
<p>脚本类配置：</p>
<ul>
<li>before_script</li>
<li>script</li>
<li>after_script</li>
</ul>
<p>缓存类配置：</p>
<ul>
<li>cache</li>
<li>artifacts</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cleam.github.io/2021/05/18/Git工作流之派生工作流/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cleam Lee">
      <meta itemprop="description" content="前端生涯记录总结">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老李">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/05/18/Git工作流之派生工作流/" class="post-title-link" itemprop="https://cleam.github.io/index.html">Git工作流之派生工作流</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-05-18 19:39:14" itemprop="dateCreated datePublished" datetime="2021-05-18T19:39:14+08:00">2021-05-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-09-23 09:52:25" itemprop="dateModified" datetime="2021-09-23T09:52:25+08:00">2021-09-23</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2021/05/18/Git工作流之派生工作流/#SOHUCS" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span id="url::https://cleam.github.io/2021/05/18/Git工作流之派生工作流/" class="cy_cmt_count" data-xid="2021/05/18/Git工作流之派生工作流/" itemprop="commentsCount"></span>
                </a>
              
            
          

          
          

          

          

          

        </span></div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>派生（forking）工作流</strong>与其他流行的 Git 工作流根本不同。它没有使用单个服务器端仓库作为“中央”代码库，而是为每个开发人员提供了自己的服务器端仓库。这意味着每个贡献者都是两个 Git 仓库：一个私有本地仓库和一个公共服务器端仓库。<strong>派生工作流最常见于公共开源项目中。</strong></p>
<p>派生工作流的主要优点是可以集成贡献，而无需每个人都将其推送到单个中央仓库。开发人员将推送到他们自己的服务器端仓库，只有项目维护者才能推送到官方仓库。这使维护者可以接受任何开发人员的提交，而无需授予他们对官方代码库的写访问权限。</p>
<p>派生工作流通常遵循基于《<a href="/2021/05/17/Git工作流之GitFlow工作流/" title="Git工作流之GitFlow工作流">Git工作流之GitFlow工作流</a>》的分支模型。这意味着将使用完整的功能分支来合并到原始项目维护者的仓库中。结果是一个分布式工作流，为大型组织团队（包括不受信任的第三方）提供灵活的方式来安全地进行协作。这也使其成为开源项目的理想工作流程。</p>
<h2>运作原理</h2>
<p>与其他 Git 工作流程一样，派生工作流从存储在服务器上的官方公共仓库开始。但是，当新的开发人员希望开始从事该项目时，他们不会直接克隆官方仓库。</p>
<p>相反，他们<code>派生（fork）</code>了官方仓库以在服务器上创建它的副本。此新副本将用作其个人公共存储库-不允许其他开发人员将其推送到其中，但他们可以从中进行更改（我们稍后将解释为什么这很重要）。在创建服务器端副本之后，开发人员执行，<code>git clone</code>将其副本复制到本地计算机上。就像其他工作流程一样，这是他们的私有开发环境。</p>
<p>准备发布本地提交时，他们会将提交推送到自己的公共仓库中，而不是正式的仓库中。然后，他们向主仓库提交<code>合并请求（pull request）</code>，这使项目维护者知道已准备好要集成更新。如果所贡献的代码存在问题，则合并请求还可以用作方便的讨论线程。以下是此工作流程的分步示例。</p>
<ol>
<li>开发人员<code>派生（fork）</code>一个“官方”服务器端存储库（这将创建自己的服务器端副本）；</li>
<li>新的服务器端副本将克隆（<code>git clone</code>）到其本地；</li>
<li>“官方”存储库的 Git 远程路径添加到本地（<code>git remote add origin xxx</code>）；</li>
<li>创建一个新的本地<code>功能分支（feature branch）</code>；</li>
<li>开发人员在新功能分支上进行更改；</li>
<li>将为更改创建新的提交（<code>git add &amp;&amp; git commit</code>）；</li>
<li>分支被推送到开发人员自己的服务器端（副本）；</li>
<li>开发人员打开从新分支到“官方”存储库的<code>合并请求（pull request）</code>；</li>
<li>合并请求被批准用于合并，并被合并到原始服务器端存储库中。</li>
</ol>
<p>为了将完成的功能集成到官方代码库中，维护人员将贡献者的更改拉入他们的本地存储库，检查以确保它不会破坏项目，将其合并到其本地 master 分支中，然后将其推送到服务器上的官方存储库中。贡献现在是项目的一部分，其他开发人员应从官方存储库中提取信息以同步其本地存储库。</p>
<p>重要的是要了解，Forking 工作流中“正式”存储库的概念仅仅是一个约定。实际上，使正式存储库如此正式的唯一原因是它是项目维护者的公共存储库。</p>
<h2>派生与克隆（Forking vs cloning）</h2>
<p>需要注意：“派生”不是特殊操作。派生的存储库是使用标准的<a href="https://www.atlassian.com/git/tutorials/setting-up-a-repository/git-clone" target="_blank" rel="noopener">git clone</a>命令创建的。派生的存储库通常是“服务器端克隆”，通常由诸如<a href="https://bitbucket.org/product" target="_blank" rel="noopener">Bitbucket</a>、<a href="https://about.gitlab.com/" target="_blank" rel="noopener">Gitlab </a>之类的第三方 Git 服务进行管理和托管。</p>
<h2>在派生工作流中分支</h2>
<p>就像<strong>功能分支工作流（Feature Branch Workflow）<strong>和 <strong>Gitflow 工作流</strong>一样，开发者仍然应该使用分支来隔离各个功能。唯一的区别是这些分支如何共享。在</strong>派生（Forking）工作流</strong>中，中央存储库被拉到另一个开发人员的本地存储库中，而在功能分支工作流和 Gitflow 工作流中，它们被推到官方存储库中。</p>
<h2>派生存储库（Fork a repository）</h2>
<p>派生（Forking）工作流项目的所有新开发人员都需要派生正式存储库。如前所述，派生只是一种标准<code>git clone</code>操作。可以通过 <code>SSH</code>进入服务器并运行<code>git clone</code>将其复制到服务器上的另一个位置来实现。流行的 Git 托管服务提供了自动执行此步骤的派生功能。</p>
<h2>克隆派生仓库（Clone your fork）</h2>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://user@bitbucket.org/user/repo.git</span><br></pre></td></tr></table></figure></p>
<h2>添加远程跟踪分支（Adding a remote）</h2>
<p>其他 Git 工作流程使用指向中央存储库的单个原始远程服务器，而 Forking 工作流则需要两个远程服务器-一个用于官方存储库，一个用于开发人员的个人服务器端存储库。虽然您可以随意调用这些远程服务器，但通常的约定是使用<code>origin</code>作为派生存储库的远程服务器（运行<code>git clone</code>时将自动创建该远程服务器），并使用上游作为正式存储库的远程服务器。</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git remote add upstream https://bitbucket.org/maintainer/repo</span><br><span class="line"><span class="comment"># 身份验证</span></span><br><span class="line"><span class="comment"># git remote add upstream https://user@bitbucket.org/maintainer/repo.git</span></span><br></pre></td></tr></table></figure></p>
<h2>在分支中工作：开发和推送更改（making &amp; pushing changes）</h2>
<p>就像其他 Git 工作流程中一样，他们可以在开发人员的本地化分支存储库副本中编辑代码，提交更改并创建分支：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b some-feature <span class="comment"># Edit some code</span></span><br><span class="line">git commit -a -m <span class="string">"Add first draft of some feature"</span></span><br></pre></td></tr></table></figure></p>
<p>他们所做的所有更改都将完全是私有的，直到将其推送到其公共存储库中为止。而且，如果正式项目向前发展，他们可以使用<code>git pull</code>访问新的提交：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull upstream master</span><br></pre></td></tr></table></figure></p>
<p>由于开发人员应在专用功能分支中工作，因此通常应导致快速合并。</p>
<h2>发起合并请求（Making a Pull Request）</h2>
<p><img src="/uploads/post/forking_01.svg" alt="pull request"></p>
<p>一旦开发人员准备好共享他们的新功能，他们需要做两件事。首先，他们必须将其贡献推送到其公共存储库中，以使其他开发人员可以访问他们的贡献。他们的源远程跟踪库应该已经设置好了，所以他们要做的就是以下操作：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin feature-branch</span><br></pre></td></tr></table></figure></p>
<p>其次，他们需要通知项目维护者他们想将其功能合并到官方代码库中。Git 托管服务（如 Bitbucket、Gitlab）提供了一个“<code>合并请求（pull request）</code>”按钮，该按钮会提交一个表单，要求您指定要合并到官方存储库中的分支。通常，您需要将<code>功能分支</code>集成到上游远程的<code>主分支</code>中。</p>
<h2>总结</h2>
<p>回顾一下，派生（Forking）工作流通常在公共开源项目中使用。派生是在项目存储库的服务器副本上执行的<code>git clone</code>操作。派生工作流通常与 Bitbucket 之类的 Git 托管服务结合使用。</p>
<p>派生（forking）工作流的高级示例是：</p>
<ol>
<li>您想为托管在<code>bitbucket.org/userA/open-project</code>上的开源库做出贡献；</li>
<li>使用 Bitbucket，您可以创建一个仓库的分支到<code>bitbucket.org/YourName/open-project</code>；</li>
<li>在您的本地，您可以运行<code>git clone</code>以获取仓库的本地副本；</li>
<li>您在本地仓库中创建一个新的<code>功能分支</code>；</li>
<li>完成新功能的工作已完成，并运行<code>git commit</code>执行了保存更改的工作；</li>
<li>然后，您将新<code>功能分支</code>推送到您的远程<code>派生仓库</code>中；</li>
<li>使用 Bitbucket 您可以在<code>bitbucket.org/userA/open-project</code>上针对原始仓库对新分支发起一个<code>合并请求（pull request）</code>。</li>
</ol>
<p><strong>派生（forking）工作流</strong>可帮助项目的维护者打开存储库以接受任何开发人员的贡献，而不必手动管理每个贡献者的授权设置。这为维护人员提供了更多的“拉”式工作流程。<strong>派生（forking）工作流最常用于开放源代码项目</strong>，也可以应用于私有业务工作流，以从对合并到发行进行更权威的控制，这对于具有发布部署管理或严格发布周期的团队很有用。</p>
<p>不确定哪种工作流程适合您？查看我们全面的<a href="https://www.atlassian.com/git/tutorials/comparing-workflows" target="_blank" rel="noopener">Git 工作流比较页面</a>。</p>
<p><a href="https://www.atlassian.com/git/tutorials/comparing-workflows/forking-workflow" target="_blank" rel="noopener">英文原文</a></p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cleam.github.io/2021/05/17/Git工作流之GitFlow工作流/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cleam Lee">
      <meta itemprop="description" content="前端生涯记录总结">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老李">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/05/17/Git工作流之GitFlow工作流/" class="post-title-link" itemprop="https://cleam.github.io/index.html">Git工作流之GitFlow工作流</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-05-17 15:12:15" itemprop="dateCreated datePublished" datetime="2021-05-17T15:12:15+08:00">2021-05-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-09-23 09:52:29" itemprop="dateModified" datetime="2021-09-23T09:52:29+08:00">2021-09-23</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2021/05/17/Git工作流之GitFlow工作流/#SOHUCS" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span id="url::https://cleam.github.io/2021/05/17/Git工作流之GitFlow工作流/" class="cy_cmt_count" data-xid="2021/05/17/Git工作流之GitFlow工作流/" itemprop="commentsCount"></span>
                </a>
              
            
          

          
          

          

          

          

        </span></div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>GitFlow 工作流（GitFlow Workflow）<strong>是一个 Git 工作流程，可帮助持续进行软件开发和实施 <a href="https://www.atlassian.com/devops/what-is-devops" target="_blank" rel="noopener">DevOps</a> 实践。它最初<a href="http://nvie.com/posts/a-successful-git-branching-model/" target="_blank" rel="noopener">由 Vincent Driessen 在 nive 上发行</a>并广受欢迎。Gitflow 工作流定义了围绕项目发行版设计的严格分支模型。这为管理</strong>较大的项目</strong>提供了一个强大的框架。</p>
<p>Gitflow 非常适合具有预定发布周期的项目以及<a href="https://www.atlassian.com/continuous-delivery" target="_blank" rel="noopener">DevOps 连续交付</a>的<a href="https://www.atlassian.com/devops/what-is-devops/devops-best-practices" target="_blank" rel="noopener">最佳实践</a>。此工作流程未添加《<a href="/2021/05/15/Git工作流之功能分支工作流/" title="Git工作流之功能分支工作流">Git工作流之功能分支工作流</a>》所需的任何新概念或命令。而是将非常具体的角色分配给不同的分支，并定义它们应如何以及何时进行交互。除了功能分支外，它还使用单独的分支来准备、维护和记录版本。当然，您还可以利用功能分支工作流（Feature Branch Workflow）的所有好处：合并请求、功能试验和更有效的协作。</p>
<h2>入门</h2>
<p>Gitflow 实际上只是 Git 工作流的抽象概念。这意味着它决定了要建立哪种分支以及如何将它们合并在一起。我们将触及以下分支的目的。 <code>git-flow工具集</code>是具有安装过程的实际命令行工具，安装过程很简单，git-flow 的软件包可在多个操作系统上使用。</p>
<ul>
<li>Mac OS: <code>brew install git-flow</code></li>
<li>Windows: <a href="https://git-scm.com/download/win" target="_blank" rel="noopener">下载并安装 git-flow</a></li>
</ul>
<p>安装 git-flow 后，您可以通过执行<code>git flow init</code>在项目中使用它。Git-flow 是基于 Git 的包装，<code>git flow init</code>命令是<code>git init</code>命令的扩展，除了为您创建分支外，不会更改仓库中的任何内容。</p>
<h2>运作原理</h2>
<p><img src="/uploads/post/gitflow_01.svg" alt="how it works"></p>
<h3>develop 和 master 分支</h3>
<p>该工作流使用两个分支而不是单个主（master）分支来记录项目的历史记录。master 分支存储正式的发行历史，而 develop 分支则充当功能的集成分支。使用版本号标记 master 分支中的所有提交也很方便。</p>
<p>第一步是用一个<code>develop分支</code>来补充默认的 master。一种简单的方法是让一个开发人员在本地创建一个空的 develop 分支并将其推送到服务器：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch develop</span><br><span class="line">git push -u origin develop</span><br></pre></td></tr></table></figure></p>
<p>该分支将包含项目的完整历史记录，而 master 将包含简化版本。现在，其他开发人员应该克隆中央仓库，并为<code>develop</code>创建跟踪分支。</p>
<p>使用 git-flow 扩展库时，在现有存储库上执行<code>git flow init</code>将创建<code>develop</code>分支：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ git flow init</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> ~/project/.git/</span><br><span class="line">No branches exist yet. Base branches must be created now.</span><br><span class="line">Branch name <span class="keyword">for</span> production releases: [master]</span><br><span class="line">Branch name <span class="keyword">for</span> <span class="string">"next release"</span> development: [develop]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">How to name your supporting branch prefixes?</span><br><span class="line">Feature branches? [feature/]</span><br><span class="line">Release branches? [release/]</span><br><span class="line">Hotfix branches? [hotfix/]</span><br><span class="line">Support branches? [support/]</span><br><span class="line">Version tag prefix? []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ git branch</span><br><span class="line">* develop</span><br><span class="line"> master</span><br></pre></td></tr></table></figure></p>
<h2>功能分支（feature branches）</h2>
<p>每个新功能应驻留在其自己的分支中，可以将其<a href="https://www.atlassian.com/git/tutorials/syncing/git-push" target="_blank" rel="noopener">推送到中央仓库</a>以进行备份与协作。但是，功能分支不是基于<code>master分支</code>，而是将<code>develop分支</code>用作其父分支。当功能开发完成后，它会重新合并到<code>develop分支</code>中。功能绝不能直接与<code>master分支</code>进行交互。</p>
<p><img src="/uploads/post/gitflow_02.svg" alt="feature branches"></p>
<p>请注意，出于所有意图和目的，将<code>功能分支（feature branch）</code>与<code>开发分支（develop）</code>结合使用是<strong>功能分支工作流</strong>的处理方式。但是，<strong>Gitflow 工作流</strong>并不止于此。</p>
<p>通常创建<code>功能分支</code>是基于<code>最新的开发分支（develop）</code>。</p>
<h3>创建一个功能分支</h3>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不使用git-flow 扩展工具方式：</span></span><br><span class="line">git checkout develop</span><br><span class="line">git checkout -b feature_branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用git-flow 扩展工具方式：</span></span><br><span class="line">git flow feature start feature_branch</span><br></pre></td></tr></table></figure></p>
<h3>完成一个功能分支</h3>
<p>完成功能开发工作后，下一步就是将<code>功能分支（feature branch）</code>合并到<code>开发分支（develop）</code>中。</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不使用git-flow 扩展工具方式：</span></span><br><span class="line">git checkout develop</span><br><span class="line">git merge feature_branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用git-flow 扩展工具方式：</span></span><br><span class="line">git flow feature finish feature_branch</span><br></pre></td></tr></table></figure></p>
<h2>发布分支（release branches）</h2>
<p><img src="/uploads/post/gitflow_03.svg" alt="release branches"></p>
<p>一旦<code>开发分支（develop）</code>获得了足够的功能以进行发布（或临近预定的发布日期），就可以从开发分支（develop）中<code>派生（fork）</code>一个<code>发布分支（release）</code>。创建此分支将开始下一个<strong>发行周期</strong>，因此此刻之后不能添加任何新功能-该分支中仅应包含错误修复、文档生成以及其他面向发行版的任务。一旦准备好发布，<code>发布分支</code>将合并到<code>master</code>并用版本号标记。此外，应该将其重新合并到开发分支（develop）中。</p>
<p>使用专门的分支来准备发布，使一个团队可以完善 ​​ 当前版本，而另一个团队可以继续开发下一个版本的功能。</p>
<p>&lt;!-- 它还创建了明确定义的开发阶段（例如，很容易地说：“本周我们正在为版本 4.0 做准备，并且可以在存储库的结构中实际看到它）。” --&gt;</p>
<p>创建<code>发布分支</code>是另一种直接的分支操作。像<code>功能分支</code>一样，发布分支也基于<code>开发分支</code>。可以使用以下方法创建新的<code>发布分支</code>。</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不使用git-flow 扩展工具方式：</span></span><br><span class="line">git checkout develop</span><br><span class="line">git checkout -b release/0.1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用git-flow 扩展工具方式：</span></span><br><span class="line">$ git flow release start 0.1.0</span><br><span class="line">Switched to a new branch <span class="string">'release/0.1.0'</span></span><br></pre></td></tr></table></figure></p>
<p>一旦<code>release分支</code>准备好发布，它将被合并到 master 中并进行开发，然后<strong>发布分支将被删除</strong>。重新合并到<code>develop分支</code>中很重要，因为关键更新可能已添加到 release 分支，并且新功能需要访问这些更新。如果您的团队要求<code>代码评审</code>，那么这将是提出发起<code>合并请求</code>的理想场所。</p>
<p>要完成<code>release分支</code>，请使用以下方法：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不使用git-flow 扩展工具方式：</span></span><br><span class="line">git checkout master</span><br><span class="line">git merge release/0.1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用git-flow 扩展工具方式：</span></span><br><span class="line">git flow release finish <span class="string">'0.1.0'</span></span><br></pre></td></tr></table></figure></p>
<h2>热修分支（hotfix branches）</h2>
<p><img src="/uploads/post/gitflow_04.svg" alt="hotfix branches"></p>
<p>维护或<code>热修分支（hotfix）</code>用于快速修补生产版本。热修分支（hotfix）与发布分支（release）以及功能（feature）分支很像，只是它们基于<code>master</code>而不是<code>develop</code>分支。这是唯一应直接基于<code>master</code>而创建的分支。修复完成后，应将其<code>合并到master和develop</code>（或当前 release 分支）中，并应使用<code>更新的版本号</code>标记 master。</p>
<p>拥有专用的错误修复开发线（hotfix 分支），您的团队可以在不中断其余工作流程或不等待下一个发布周期的情况下解决问题。您可以将<code>热修分支（hotfix）</code>视为直接与 master 一起使用的临时发布分支。可以使用以下方法创建热修分支：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不使用git-flow 扩展工具方式：</span></span><br><span class="line">git checkout master</span><br><span class="line">git checkout -b hotfix_branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用git-flow 扩展工具方式：</span></span><br><span class="line">git flow hotfix start hotfix_branch</span><br></pre></td></tr></table></figure></p>
<p>与完成发布分支相似，热修分支也<code>合并到master和develop</code>中。</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不使用git-flow 扩展工具方式：</span></span><br><span class="line">git checkout master</span><br><span class="line">git merge hotfix_branch</span><br><span class="line">git checkout develop</span><br><span class="line">git merge hotfix_branch</span><br><span class="line">git branch -D hotfix_branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用git-flow 扩展工具方式：</span></span><br><span class="line">git flow hotfix finish hotfix_branch</span><br></pre></td></tr></table></figure></p>
<h2>示例</h2>
<p>完整示例如下，假设我们有一个带有 master 分支的仓库。</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git checkout master</span><br><span class="line">git checkout -b develop</span><br><span class="line">git checkout -b feature_branch</span><br><span class="line"><span class="comment"># work happens on feature branch 发生在功能分支的工作</span></span><br><span class="line">git checkout develop</span><br><span class="line">git merge feature_branch</span><br><span class="line">git checkout master</span><br><span class="line">git merge develop</span><br><span class="line">git branch -d feature_branch</span><br></pre></td></tr></table></figure></p>
<p>除了功能开发和发布流程外，<code>热修（hotfix）</code>示例如下：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git checkout master</span><br><span class="line">git checkout -b hotfix_branch</span><br><span class="line"><span class="comment"># work is done commits are added to the hotfix_branch</span></span><br><span class="line">git checkout develop</span><br><span class="line">git merge hotfix_branch</span><br><span class="line">git checkout master</span><br><span class="line">git merge hotfix_branch</span><br></pre></td></tr></table></figure></p>
<h2>总结</h2>
<p>在这里，我们讨论了 Gitflow 工作流。 Gitflow 是您和您的团队可以利用的多种《<a href="/2021/05/13/Git工作流/" title="Git工作流">Git工作流</a>》之一。</p>
<p>了解 Gitflow 的一些关键点：</p>
<ul>
<li>该工作流程非常适合基于发行版的软件工作流程。</li>
<li>Gitflow 为生产修复程序提供了专用渠道（热修分支）。</li>
</ul>
<p>Gitflow 的总体流程为：</p>
<ol>
<li>一个基于<code>主分支（master）</code>创建的<code>开发分支（develop）</code>；</li>
<li>一个基于开发分支创建的<code>发布分支（release）</code>;</li>
<li><code>功能分支（feature branch）</code>基于开发分支创建；</li>
<li>功能完成后，将其合并到开发分支中;</li>
<li>完成发布分支后，将它<code>合并到master和develop</code>中；</li>
<li>如果检测到<code>主分支（master）</code>出现问题，则会从主分支中创建一个<code>热修分支（hotfix）</code>;</li>
<li>热修分支完成后，将它<code>合并到master和develop</code>中。</li>
</ol>
<p>接下来，了解分《<a href="/2021/05/18/Git工作流之派生工作流/" title="Git工作流之派生工作流">Git工作流之派生工作流</a>》</p>
<blockquote>
<p><a href="https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow" target="_blank" rel="noopener">英文原文</a></p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cleam.github.io/2021/05/15/Git工作流之功能分支工作流/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cleam Lee">
      <meta itemprop="description" content="前端生涯记录总结">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老李">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/05/15/Git工作流之功能分支工作流/" class="post-title-link" itemprop="https://cleam.github.io/index.html">Git工作流之功能分支工作流</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-05-15 18:15:22" itemprop="dateCreated datePublished" datetime="2021-05-15T18:15:22+08:00">2021-05-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-09-23 09:52:17" itemprop="dateModified" datetime="2021-09-23T09:52:17+08:00">2021-09-23</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2021/05/15/Git工作流之功能分支工作流/#SOHUCS" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span id="url::https://cleam.github.io/2021/05/15/Git工作流之功能分支工作流/" class="cy_cmt_count" data-xid="2021/05/15/Git工作流之功能分支工作流/" itemprop="commentsCount"></span>
                </a>
              
            
          

          
          

          

          

          

        </span></div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>**Git 功能分支工作流（Feature Branch Workflow）**背后的核心思想是所有功能开发应在专用分支而不是<code>master</code>分支中进行。这种封装使多个开发人员可以轻松地使用特定功能，而又不会干扰主代码库。这也意味着<code>master</code>分支将永远不会包含残破的代码，这对于持续集成环境是一个巨大的优势。</p>
<p>功能分支开发还可以利用<strong>合并请求（pull request）</strong>，这是围绕分支发起讨论的一种方式。这为其他开发人员提供了在功能集成到正式项目中之前对其进行审查的机会。甚至，如果您在开发功能过程中卡住了，则可以开启一个<strong>合并请求（pull request）</strong>，以征询同事的建议。更关键是，合并请求操作使您的团队可以非常轻松地就彼此的工作发表讨论。</p>
<p>Git 功能分支工作流是可组合的工作流程，其他高级 Git 工作流程也可以利用。Git 功能分支工作流是针对分支模型的，这意味着它是用于管理和创建分支的指导框架，其他工作流则更以仓库为中心。 Git 功能分支工作流可以合并到其他工作流程中。实际上，<strong>GitFlow 工作流（GitFlow Workflow）<strong>和</strong>Git 派生工作流（Forking Workflow）<strong>在其分支模型方面使用了</strong>Git 功能分支工作流（Feature Branch Workflow）</strong>。</p>
<h2>运作原理</h2>
<p>Git 功能分支工作流（Feature Branch Workflow）假设有一个中央仓库，而<strong>master</strong>则代表正式的项目历史记录，开发人员在每次开始使用新功能时都创建一个新分支，而不是直接在其本地<strong>master</strong>分支上提交。功能分支应具有描述性名称，例如<code>animated-menu-items</code>、<code>issue-#1061</code>或<code>feature_xxxx</code>，这样命名的目的是明确每一个分支的功能和作用。 Git 在主分支和功能分支之间没有技术上的区别，因此开发人员可以编辑、暂存和提交对功能分支的更改。</p>
<p>另外，可以（并且应该）将功能分支推送到中央仓库，这样就可以与其他开发人员共享功能，而无需更改任何正式代码。由于<code>master</code>是唯一的“特殊”分支，因此在中央仓库中存储多个功能分支不会造成任何问题。当然，这也是备份每个人的本地提交的便捷方法。以下是<strong>功能分支的生命周期。</strong></p>
<h3>从主（master）分支开始</h3>
<p>所有功能分支都是根据项目的最新代码状态创建的。这里假设 master 分支即为我们项目的主分支。</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git checkout master <span class="comment"># 切换到 master 分支</span></span><br><span class="line">git fetch origin  <span class="comment"># 提取最新的提交</span></span><br><span class="line">git reset --hard origin/master <span class="comment"># 重置仓库的master本地副本</span></span><br></pre></td></tr></table></figure></p>
<p>这会将仓库切换到 master 分支，提取最新的提交，并重置仓库的<code>master</code>本地副本以匹配最新版本。</p>
<h3>创建新分支</h3>
<p>针对每一个新功能（或新 bug ）创建一个单独的分支。创建分支后，请在本地将其检出（checkout），以便您所做的任何更改都将在该分支上。</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b new-feature</span><br></pre></td></tr></table></figure></p>
<p>这会检出一个基于<code>master</code>的名为<code>new-feature</code>的分支，并且<code>-b</code>标志告诉 Git 创建该分支（如果该分支不存在）。</p>
<h3>更新</h3>
<p>在该分支上，以正常的方式编辑、暂存和提交更改，并根据需要构建多次提交。</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git status  <span class="comment"># 查看状态</span></span><br><span class="line">git add &lt;some-file&gt; <span class="comment"># 暂存文件</span></span><br><span class="line">git commit  <span class="comment"># 提交更改</span></span><br></pre></td></tr></table></figure></p>
<h3>将功能分支推送到远程（中央仓库）</h3>
<p>最好将功能分支推送到中央仓库。与其他开发人员协作时，这既可以用作备份，也能使其他人查看到新分支的提交。</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -u origin new-feature</span><br></pre></td></tr></table></figure></p>
<p>这样便将新功能推送到中央仓库（origin），并且加上<code>-u</code>标志将其添加为（上游）远程跟踪分支。设置跟踪分支后，后面提交代码时，无需任何其他参数即可通过<code>git push</code>命令来自动将更新操作推送到远程中央仓库。</p>
<p>接着，到 <strong>git 仓库管理平台</strong>（如 Bitbucket、Gitlab）去创建<strong>合并请求</strong>，将功能分支合并到<code>master</code>主分支。可以在提合并请求时指定审批人以确保顺利合并。（其间，如果有冲突，需要先解决冲突再提交）</p>
<h2>合并请求</h2>
<p>除了隔离功能开发之外，Git 分支还可以通过合并请求来讨论更改。某人完成一项功能后，不会立即将其合并到主功能中，相反，他们将功能分支推送到中央仓库，并提出合并请求，要求将其更改合并到主分支中。这使其他开发人员有机会在其更改成为主代码的一部分之前对其进行<strong>代码审查（code review）</strong>。</p>
<p><strong>代码审查</strong>是合并请求的主要好处，但实际上，它们是被设计用来讨论代码的通用方法。您可以将合并请求视为用于专门讨论特定分支的讨论地。这意味着它们也可以在开发过程中更早地被使用。例如，如果开发人员需要特定功能的帮助，则他们要做的就是提交合并请求。感兴趣的各方将被自动通知，他们将能够在相关提交旁边看到问题。</p>
<p>一旦合并请求被接受后，发布一个功能的实际操作与《<a href="/2021/05/14/Git工作流之集中式工作流/" title="Git工作流之集中式工作流">Git工作流之集中式工作流</a>》中的操作几乎相同。(关于合并请求，首先，您需要确保本地主机与上游主机同步。然后，将功能分支合并到 master 中，并将更新后的 master 推回中央仓库。仓库管理平台&lt;如 Bitbucket、Gitlab&gt;可以更好的简化该操作)。</p>
<h2>示例</h2>
<p>以下是使用功能分支工作流的示例，该场景是一个团队围绕新功能合并请求（<code>pull request</code>）进行代码审查（<code>code review</code>）的场景：</p>
<h3>小丽开始一个新功能开发</h3>
<p><img src="/uploads/post/model.svg" alt="model"></p>
<p>在开始开发功能之前，<strong>小丽</strong>需要一个新的分支来进行工作，她可以使用下面命令创建一个新功能分支：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b xl-feature master</span><br></pre></td></tr></table></figure></p>
<p>这样便基于<code>master</code>分支创建了一个叫<code>xl-feature</code>的分支，<code>-b</code>标记是告诉 git 如果分支不存在就创建分支。</p>
<p><strong>小丽</strong>为了完成新功能，在分支上进行开发、修改以及提交操作（可能重复多次）：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br><span class="line">git add &lt;some-file&gt;</span><br><span class="line">git commit</span><br></pre></td></tr></table></figure></p>
<h3>小丽中途吃午饭</h3>
<p>到了午饭时间，当<strong>小丽</strong>有事要停下功能开发时，在她离开前最好将代码提交到中央仓库，一是方便代码备份；二是有利于其他开发人员看到她的初始提交。</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -u origin xl-feature</span><br></pre></td></tr></table></figure></p>
<p>此命令将<code>xl-feature</code>推送到中央仓库，并且使用参数<code>-u</code>标志将其添加为远程跟踪分支。设置跟踪分支后，<strong>小丽</strong>后面可以调用<code>git push</code>而无需添加任何其他参数来推送其功能。</p>
<h3>小丽完成新功能</h3>
<p><img src="/uploads/post/finish_xl.svg" alt="finish_xl"></p>
<p>当<strong>小丽</strong>吃完午饭回来，完成了剩余功能开发。在将其合并为 master 之前，她需要提交合并请求，以让团队的其他成员知道她已经完成了。但是首先，她应该确保中央仓库中有她的最新提交：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push</span><br></pre></td></tr></table></figure></p>
<p>然后，她通过仓库管理平台（如 Bitbucket、Gitlab）发起合并请求将<code>xl-feature</code>合并到<code>master</code>，团队其他人便可自动收到通知。合并请求的好处在于，它们在相关的提交旁边会显示注释，因此很容易提出有关特定变更的问题。</p>
<h3>小王收到合并请求</h3>
<p><img src="/uploads/post/pr_xw.svg" alt="pr_xw"></p>
<p><strong>小王</strong>收到合并请求，然后查看一下<code>xl-feature</code>，他决定在将其集成到正式项目之前要进行一些更改，并且他和<strong>小丽</strong>通过合并请求来回进行了一些操作。</p>
<h3>小丽做出更改</h3>
<p><img src="/uploads/post/change_xl.svg" alt="change_xl"></p>
<p>为了进行更改，<strong>小丽</strong>使用了该功能的第一次迭代完全相同的过程，她编辑、暂存、提交并将更新推送到中央仓库。她的所有操作行为都显示在合并请求中，并且<strong>小王</strong>在此过程中仍然可以发表评论。</p>
<p>如果他愿意，<strong>小王</strong>可以将<code>xl-feature</code>添加到他的本地仓库中，然后自己进行处理。他添加的所有提交也将显示在合并请求中。</p>
<h3>小丽发布（已完成）功能</h3>
<p><img src="/uploads/post/pf_xl.svg" alt="pf_xl"></p>
<p>一旦<strong>小王</strong>准备好接受合并请求，就需要有人将功能合并到稳定的项目中（这可以由<strong>小王</strong>或<strong>小丽</strong>来完成）：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git checkout master</span><br><span class="line">git pull</span><br><span class="line">git pull origin xl-feature</span><br><span class="line">git push</span><br></pre></td></tr></table></figure></p>
<p>某些 GUI （仓库管理平台，如 Bitbucket、Gitlab）只需单击“接受”按钮，即可通过运行所有这些命令来自动执行<code>合并请求</code>接受过程。</p>
<p>同时，<code>小明</code>也在做完全相同的事情（进行新功能开发）。</p>
<p><strong>小王</strong>和<strong>小丽</strong>正在研究<strong>小丽</strong>开发的功能，并在其合并请求中对其进行讨论时，<strong>小明</strong>则在自己的功能分支中做着完全相同的事情。我们可以看到，通过将功能隔离到单独的分支中，每个人都可以独立工作，在必要时再与其他开发人员共享更改。</p>
<h2>总结</h2>
<p>在本文中，我们讨论了<strong>Git 功能分支工作流（Feature Branch Workflow）</strong>。此工作流有助于组织和跟踪专注于业务域功能集的分支。其他 Git 工作流（如<strong>派生工作流（Forking Workflow）<strong>和</strong>GitFlow 工作流（GitFlow Workflow）</strong>）是针对仓库的，可以利用 Git 功能分支工作流（Feature Branch Workflow）来管理其分支模型。本文档演示了用于实现<strong>Git 功能分支工作流（Feature Branch Workflow）<strong>的高级代码示例和虚构示例。与</strong>功能分支工作流</strong>相关的一些关键：</p>
<ul>
<li>专注于分支模式</li>
<li>可以被其他面向仓库的工作流程所利用</li>
<li>通过合并请求和合并审查促进与团队成员的协作</li>
</ul>
<p>在功能分支的审阅和合并阶段使用 <strong><a href="https://www.atlassian.com/git/tutorials/rewriting-history/git-rebase" target="_blank" rel="noopener">git rebase</a></strong> 将强制创建功能合并的 Git 历史记录。功能分支模型是在团队环境中促进协作的出色工具。</p>
<p>接下来，我们看看《<a href="/2021/05/17/Git工作流之GitFlow工作流/" title="Git工作流之GitFlow工作流">Git工作流之GitFlow工作流</a>》来更深入的了解 Git 工作流。</p>
<blockquote>
<p><a href="https://www.atlassian.com/git/tutorials/comparing-workflows/feature-branch-workflow" target="_blank" rel="noopener">英文原文</a></p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cleam.github.io/2021/05/14/Git工作流之集中式工作流/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cleam Lee">
      <meta itemprop="description" content="前端生涯记录总结">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老李">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/05/14/Git工作流之集中式工作流/" class="post-title-link" itemprop="https://cleam.github.io/index.html">Git工作流之集中式工作流</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-05-14 10:12:22" itemprop="dateCreated datePublished" datetime="2021-05-14T10:12:22+08:00">2021-05-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-09-23 09:52:21" itemprop="dateModified" datetime="2021-09-23T09:52:21+08:00">2021-09-23</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2021/05/14/Git工作流之集中式工作流/#SOHUCS" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span id="url::https://cleam.github.io/2021/05/14/Git工作流之集中式工作流/" class="cy_cmt_count" data-xid="2021/05/14/Git工作流之集中式工作流/" itemprop="commentsCount"></span>
                </a>
              
            
          

          
          

          

          

          

        </span></div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>对于从 SVN 过渡的团队来说，集中式工作流（Centralized Workflow）是一个很棒的 Git 工作流。与<a href="https://subversion.apache.org/" target="_blank" rel="noopener">Subversion</a>一样，集中式工作流使用中央仓库作为项目所有更改的单个入口点。类比 svn 的 trunk，它 <strong>使用<code>master</code>作为默认的开发分支且所有提交操作都在该分支上。</strong> 这种工作流除了<code>master</code>分支外，不需要任何其他分支。</p>
<p>集中式工作流在使用远程服务器端托管仓库方面与其他工作流类似，开发人员可以通过这种仓库推送（<code>push</code>）和拉取（<code>pull</code>）资源。</p>
<p>与其他工作流程相比，集中式工作流程没有定义的合并请求（<code>pull request</code>）或派生（<code>fork</code>）模式。<strong>集中式工作流通常更适合从 SVN 迁移到 Git 的团队以及规模较小的团队。</strong></p>
<h2>运作原理</h2>
<h3>初始化中央仓库</h3>
<p><img src="/uploads/post/init_central_repo.svg" alt="初始化中央仓库"></p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh user@host git init --bare /path/to/repo.git</span><br></pre></td></tr></table></figure></p>
<p>一般我们将仓库托管到 git 仓库托管平台（如 Bitbucket、Gitlab），在托管平台上面初始化中央仓库。</p>
<h3>克隆中央仓库</h3>
<p>接下来，每个开发人员都将创建整个项目的本地副本。通过以下<code>git clone</code>命令完成的：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> ssh://user@host/path/to/repo.git</span><br></pre></td></tr></table></figure></p>
<p>当 clone 一个仓库时，假设您要在以后与之进行进一步的交互，Git 会自动添加一个叫<code>origin</code>的快捷方式，并指向“父”仓库。</p>
<h3>修改与提交</h3>
<p>一旦在本地克隆了仓库，开发人员就可以使用标准的 Git 提交过程进行更改：编辑（edit），暂存（stage）和提交（commit）。</p>
<blockquote>
<p>暂存：实际上就是我改了 3 个文件，但是我只想提交 2 个文件，就可以先<code>git add</code>将指定的 2 个文件暂存，然后使用<code>git commit</code>就只会提交暂存的那 2 个文件，这样便避免了提交非必要文件。</p>
</blockquote>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git status <span class="comment"># 查看仓库状态</span></span><br><span class="line">git add  <span class="comment"># 暂存</span></span><br><span class="line">git commit <span class="comment"># 提交</span></span><br></pre></td></tr></table></figure></p>
<p>请记住，由于这些命令创建了本地提交，小王可以根据需要多次重复此过程，而不必担心中央仓库中的情况。这对于需要分解为更简单，更原子的块的大型功能非常有用。</p>
<h3>推送新提交到中央仓库</h3>
<p>将本地更新推送到远程中央仓库中。</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure></p>
<p>该命令会将本地新提交的更改推送到远程中央仓库。在此推送过程中可能出现一种特殊情况就是小丽（另一开发者）在小王之前推送过代码，此时 Git 将输出一条消息，指出此冲突。</p>
<p>冲突情况下，应该先执行 Git 拉取命令：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull</span><br></pre></td></tr></table></figure></p>
<p>下一节将对此冲突情形进行扩展。</p>
<h3>冲突管理</h3>
<p>中央仓库代表官方项目，因此其提交历史应视为神圣且不可改变。如果开发人员的本地提交偏离中央仓库，则 Git 将拒绝推送其更改，因为这将覆盖官方提交。</p>
<p><img src="/uploads/post/man_conflicts.svg" alt="冲突管理"></p>
<p>在开发人员发布功能之前，他们需要获取更新的中央提交并在其基础上重新进行更改。这就像在说：“我想将自己的更改添加到其他所有人已经完成的操作中。”与传统的 SVN 工作流程一样，结果是完美的线性历史记录。</p>
<p>如果本地更改直接与上游提交冲突，则 Git 将暂停变基过程（the rebasing process），并为您提供手动解决冲突的机会。关于 Git 的好处是，它使用相同的<code>git status</code>和<code>git add</code>命令来生成提交和解决合并冲突。这使新开发人员可以轻松管理自己的合并。另外，如果他们遇到麻烦，Git 可以很轻松地中止整个重新部署并重试（或寻求帮助）。</p>
<h2>举例说明</h2>
<p>让我们举一个例子，说明典型的小型团队如何使用此 Git 工作流进行协作。我们将看到<code>小王</code>和<code>小丽</code>这两个开发人员如何使用单独的功能并通过集中式仓库共享他们的贡献。</p>
<h3>小王</h3>
<p><img src="/uploads/post/scfp_xw.svg" alt="scfp_xw"></p>
<p>在他的本地仓库中，<code>小王</code>可以使用标准的 Git 提交过程（编辑、暂存和提交）来开发功能。</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git status <span class="comment"># 查看仓库状态</span></span><br><span class="line">git add  <span class="comment"># 暂存</span></span><br><span class="line">git commit <span class="comment"># 提交</span></span><br></pre></td></tr></table></figure></p>
<p>请记住，由于这些命令创建了本地提交，因此<code>小王</code>可以根据需要多次重复此过程，而不必担心中央仓库中的情况。</p>
<h3>小丽</h3>
<p><img src="/uploads/post/scfp_xl.svg" alt="scfp_xl"></p>
<p>同时，<code>小丽</code>使用相同的（编辑、暂存和提交）过程在自己的本地仓库中开发自己的功能。像<code>小王</code>一样，她不在乎中央仓库中发生的事情，她也不用在乎<code>小王</code>在其本地仓库中正在做什么，因为所有本地仓库都是私有的。</p>
<h3>小王发布他完成的功能</h3>
<p><img src="/uploads/post/pf_xw.svg" alt="pf_xw"></p>
<p><code>小王</code>完成其功能后，应将其本地提交发布到中央仓库，以便其他团队成员可以访问它。他可以使用<code>git push</code>命令执行此操作，如下所示：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure></p>
<p>请记住，<code>源（origin）</code>是与<code>小王</code>克隆 Git 仓库时创建的中央仓库的远程连接。<code>master</code>参数告诉 Git 尝试使<code>源（origin）的master分支</code>对照<code>本地的master分支</code>。由于<code>小王</code>克隆以来中央仓库尚未更新，因此不会造成任何冲突，并且推送将按预期进行。</p>
<h3>小丽尝试发布她完成的功能</h3>
<p><img src="/uploads/post/pce_xl.svg" alt="pce_xl"></p>
<p>让我们看看如果<code>小王</code>成功将其更改发布到中央仓库后<code>小丽</code>尝试发布其功能，会发生什么情况。她可以使用完全相同的<code>push</code>命令：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure></p>
<p>但是，由于她的本地历史与中央仓库有所不同，因此 Git 会以相当冗长的错误消息拒绝该请求：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">error: failed to push some refs to <span class="string">'/path/to/repo.git'</span></span><br><span class="line">hint: Updates were rejected because the tip of your current branch is behind</span><br><span class="line">hint: its remote counterpart. Merge the remote changes (e.g. <span class="string">'git pull'</span>)</span><br><span class="line">hint: before pushing again.</span><br><span class="line">hint: See the <span class="string">'Note about fast-forwards'</span> <span class="keyword">in</span> <span class="string">'git push --help'</span> <span class="keyword">for</span> details.</span><br></pre></td></tr></table></figure></p>
<p>这样可以防止<code>小丽</code>覆盖正式提交。她需要将<code>小王</code>的更新放入仓库中，并将其与本地更改集成，然后重试。</p>
<h3>小丽重新以小王的提交为基准</h3>
<p><code>小丽</code>可以使用<code>git pull</code>将上游更改合并到她的仓库中。这个命令有点像<code>svn update</code>-将整个上游提交历史记录拉到<code>小丽</code>的本地仓库中，并尝试将其与她的本地提交集成：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull --rebase origin master</span><br></pre></td></tr></table></figure></p>
<p><code>--rebase</code>选项告诉 Git 在将其与中央仓库中的更改同步后，将所有<code>小丽</code>的提交都移至 master 分支的末端，如下所示：</p>
<p><img src="/uploads/post/rebase.svg" alt="rebase"></p>
<p>如果您忘记了此选项<code>--rebase</code>，<code>pull</code>仍然有效，但是每次有人需要与中央仓库同步时，您都会得到多余的“合并提交”。对于此工作流程，最好重新设置基准，而不是生成合并提交。</p>
<h3>小丽解决合并冲突</h3>
<p><img src="/uploads/post/rc_xl.svg" alt="rc_xl"></p>
<p>变基（<code>rebase</code>）工作是通过将每个本地提交一次一个的转移到最新的（<code>master</code>）主分支。这意味着您可以逐个提交地解决合并冲突，而不是在一个大规模合并提交中解决所有冲突。这样可以使您的提交尽可能集中，并保证项目历史记录的整洁。反过来，这使得找出错误的位置变得容易得多，并且在必要时以对项目的影响最小的方式回滚更改。</p>
<p>如果<code>小丽</code>和<code>小王</code>正在开发不相关的功能，则重新定基过程不太可能产生冲突。但如果产生了冲突，Git 将在当前提交时暂停定基（rebase），并输出以下消息以及一些相关说明：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONFLICT (content): Merge conflict <span class="keyword">in</span> xxx</span><br></pre></td></tr></table></figure></p>
<p><img src="/uploads/post/conflict_resolution.svg" alt="conflict_resolution"></p>
<p>Git 的伟大之处在于，任何人都可以解决自己的合并冲突。在我们的示例中，<code>小丽</code>只需运行<a href="https://www.atlassian.com/git/tutorials/inspecting-a-repository/git-status" target="_blank" rel="noopener">git status</a>即可查看问题出在哪里。冲突的文件将显示在“未合并的路径”部分中：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Unmerged paths:</span><br><span class="line"># (use &quot;git reset HEAD ...&quot; to unstage)</span><br><span class="line"># (use &quot;git add/rm ...&quot; as appropriate to mark resolution)</span><br><span class="line">#</span><br><span class="line"># both modified:</span><br></pre></td></tr></table></figure></p>
<p>然后，她将根据自己的喜好编辑文件。对结果感到满意后，她可以按照常用的方式暂存文件（<code>git add</code>），然后让<a href="https://www.atlassian.com/git/tutorials/rewriting-history/git-rebase" target="_blank" rel="noopener">git rebase</a>完成其余工作：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add</span><br><span class="line">git rebase --<span class="built_in">continue</span> <span class="comment"># 合并冲突，结合 git add 命令一起用于修复冲突（fix conflicts and then run "git rebase --continue"）</span></span><br></pre></td></tr></table></figure></p>
<p>以上就是一个提交的冲突处理的整个流程，Git 将继续进行下一个提交，并针对产生冲突的任何其他提交重复该过程。</p>
<p>当您（在冲突处理过程中）意识到感觉不对、不知道发生了什么时，不要惊慌，只需执行以下命令，您便会回到开始的位置：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase --abort <span class="comment"># 放弃合并，回到rebase操作之前的状态，之前的提交不会丢弃；</span></span><br></pre></td></tr></table></figure></p>
<h3>小丽成功发布已完成的功能</h3>
<p><img src="/uploads/post/scr_xl.svg" alt="scr_xl"></p>
<p>与中央仓库同步后，<code>小丽</code>将能够成功发布其更改：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure></p>
<h2>总结</h2>
<p>如您所见，仅使用少量 Git 命令即可复制传统的 Subversion 开发环境。这对于将团队从 SVN 过渡过来非常有用，但它没有利用 Git 的分布式特性。</p>
<p>集中式工作流程非常适合小型团队。当您的团队规模扩大时，上面详述的冲突解决过程可能会成为瓶颈。如果您的团队对集中式工作流程感到满意，但想简化其协作工作，那么绝对值得探索<a href="/2021/05/15/Git工作流之功能分支工作流/" title="Git工作流之功能分支工作流">Git工作流之功能分支工作流</a>。通过为每个功能指定一个独立的分支，可以在将新功能集成到正式项目中之前就新功能进行深入的讨论。</p>
<blockquote>
<p><a href="https://www.atlassian.com/git/tutorials/comparing-workflows" target="_blank" rel="noopener">英文原文</a></p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cleam.github.io/2021/05/13/Git工作流/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cleam Lee">
      <meta itemprop="description" content="前端生涯记录总结">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老李">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2021/05/13/Git工作流/" class="post-title-link" itemprop="https://cleam.github.io/index.html">Git工作流</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-05-13 16:10:10" itemprop="dateCreated datePublished" datetime="2021-05-13T16:10:10+08:00">2021-05-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-09-23 09:52:13" itemprop="dateModified" datetime="2021-09-23T09:52:13+08:00">2021-09-23</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2021/05/13/Git工作流/#SOHUCS" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span id="url::https://cleam.github.io/2021/05/13/Git工作流/" class="cy_cmt_count" data-xid="2021/05/13/Git工作流/" itemprop="commentsCount"></span>
                </a>
              
            
          

          
          

          

          

          

        </span></div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Git 工作流程是有关如何使用 Git 以一致且富有成效的方式完成工作的秘诀或建议。Git 工作流程鼓励用户有效，一致地利用 Git。</p>
<p>Git 在用户管理变更方面提供了很大的灵活性，鉴于 Git 对灵活性的关注，没有关于如何与 Git 交互的标准化流程。所以 <code>与团队合作进行 Git 管理的项目时，重要的是要确保团队就如何应用变更流程达成一致。</code> 为确保团队在同一页面上，应开发或选择一个已达成共识的 Git 工作流程。</p>
<h2>什么是成功的 Git 工作流？</h2>
<p>在为团队评估工作流时，最重要的是要考虑团队的文化。您希望工作流能够提高团队的效率，而不是限制生产力的负担。评估 Git 工作流程时应考虑以下几点：</p>
<ul>
<li>此工作流程是否随团队规模扩展？</li>
<li>使用此工作流程是否容易减少犯错和错误？</li>
<li>此工作流程是否会给团队带来新的不必要的认知开销？</li>
</ul>
<h2>软件团队常见 Git 工作流</h2>
<ul>
<li>集中式工作流（Centralized Workflow）</li>
<li>功能分支工作流（Feature Branch Workflow）</li>
<li>GitFlow 工作流（GitFlow Workflow）</li>
<li>派生工作流（Forking Workflow）</li>
</ul>
<p><img src="/uploads/post/wf_Centralized.jpg" alt="Centralized Workflow">
<img src="/uploads/post/wf_FeatureBranch.jpg" alt="Feature Branch Workflow">
<img src="/uploads/post/wf_GitFlow.jpg" alt="GitFlow Workflow">
<img src="/uploads/post/wf_Forking.jpg" alt="Forking Workflow"></p>
<p>至于团队应该使用哪种工作流，这要取决于团队具体情况来定。<strong>最好的不一定好，最适合的才最好</strong>，不同团队有不同的工作流。像我们团队采用的工作流并非上面 4 选 1，而是结合（功能分支、派生工作流）起来形成了适合自己的工作流。</p>
<blockquote>
<p><a href="https://www.atlassian.com/git/tutorials/comparing-workflows" target="_blank" rel="noopener">英文原文</a></p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/uploads/avatar.png" alt="Cleam Lee">
            
              <p class="site-author-name" itemprop="name">Cleam Lee</p>
              <p class="site-description motion-element" itemprop="description">前端生涯记录总结</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">23</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/cleam" title="GitHub &rarr; https://github.com/cleam" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://twitter.com/Cleam_Lee" title="Twitter &rarr; https://twitter.com/Cleam_Lee" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>Twitter</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://weibo.com/lzg2049" title="微博 &rarr; https://weibo.com/lzg2049" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>微博</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cleam Lee</span>

  

  
</div>









        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.5.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.5.0"></script>



  



  




  
    <script id="cy_cmt_num" src="https://changyan.sohu.com/upload/plugins/plugins.list.count.js?clientId=cyv4uru5Q"></script>
  







  





  

  

  

  

  

  
  

  

  

  

  

  

  

</body>
</html>
